<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>phpenv + php-build + composer で開発環境作ってみた | 69log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。">
<meta property="og:type" content="article">
<meta property="og:title" content="phpenv + php-build + composer で開発環境作ってみた">
<meta property="og:url" content="http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/index.html">
<meta property="og:site_name" content="69log">
<meta property="og:description" content="以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="phpenv + php-build + composer で開発環境作ってみた">
<meta name="twitter:description" content="以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。">
  
    <link rel="alternative" href="/atom.xml" title="69log" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-9196861-14', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
    <header role="header">
  <div class="header cf">
    <div class="title-content">
      <h1>
        <a href="/">69log</a>
      </h1>
      
        <h2>
          <a href="/">福岡でwebの仕事をしています</a>
        </h2>
      
    </div>

    <div class="nav-content cf">
      <nav>
        
          <a href="/" class="nav-link nav-home">home</a>
        
          <a href="/archives" class="nav-link nav-archives">archives</a>
        
        
          <a href="/atom.xml" title="RSS Feed" class="icon nav-link nav-feed"></a>
        
      </nav>
      <div class="header-search">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="q" value="site:http://blog.kazu69.net"></form>
      </div>
    </div>
  </div>
</header>

    <main role="main" id="main">
      <section><article id="post-phpenv-php-build-composer" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    
      
  
    <h1 class="article-title" itemprop="name">
      phpenv + php-build + composer で開発環境作ってみた
    </h1>
  

    
    <div class="article-meta clr">
      <time datetime="2013-02-06T10:11:56.000Z" itemprop="datePublished">2013-02-06</time>

      
  <div class="article-category">
    <a class="article-category-link" href="/categories/memo/">memo</a>
  </div>

    </div>
  </header>

  <div class="article-entry" itemprop="articleBody">
    <div class="article-gallery">
      
    </div>
    
      <p>以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。<br><a id="more"></a></p>
<h2 id="Apache_install">Apache install</h2><p>自分のmac(Mac10.8)ではあらかじめApacheは入っているのですが、せっかくなのでApache installから。</p>
<p>[shell]</p>
<p>$ brew tap Homebrew/dupes<br>$ brew install httpd</p>
<p>[/shell]</p>
<p>ApacheやPHPは<a href="http://mxcl.github.com/homebrew/" target="_blank" rel="external">homebrew</a>のFormulaでは管理されてないのですが、Homebrewに新たに追加されたtapコマンド使うことで任意のFormulaを追加できるらしい。<br>ちなみにtapが使えないときは<a href="https://github.com/mxcl/homebrew/wiki/FAQ" target="_blank" rel="external">brewのupdate</a>が必要。</p>
<p>続いてhttpd.confの設定</p>
<p>/usr/local/Cellar/httpd/2.2.22/etc/apache2/httpd.conf の 155行目付近<br>[shell]</p>
<h1 id="ServerName_gives_the_name_and_port_that_the_server_uses_to_identify_itself-">ServerName gives the name and port that the server uses to identify itself.</h1><h1 id="This_can_often_be_determined_automatically,_but_we_recommend_you_specify">This can often be determined automatically, but we recommend you specify</h1><h1 id="it_explicitly_to_prevent_problems_during_startup-">it explicitly to prevent problems during startup.</h1><p>#</p>
<h1 id="If_your_host_doesn’t_have_a_registered_DNS_name,_enter_its_IP_address_here-">If your host doesn’t have a registered DNS name, enter its IP address here.</h1><p>#</p>
<p>ServerName localhost:80</p>
<p>[/shell]</p>
<p>DocumentRootを変更するならば、</p>
<p>[shell]<br>#</p>
<h1 id="DocumentRoot:_The_directory_out_of_which_you_will_serve_your">DocumentRoot: The directory out of which you will serve your</h1><h1 id="documents-_By_default,_all_requests_are_taken_from_this_directory,_but">documents. By default, all requests are taken from this directory, but</h1><h1 id="symbolic_links_and_aliases_may_be_used_to_point_to_other_locations-">symbolic links and aliases may be used to point to other locations.</h1><p>#<br>DocumentRoot &amp;quot;/Library/WebServer/Documents/&amp;quot;</p>
<p>[/shell]</p>
<p>php5のモジュールはコメントアウトされているときはコメントアウトを削除しておく</p>
<p>[shell]</p>
<p>LoadModule php5_module libexec/libphp5.so</p>
<p>[/shell]</p>
<p>.phpでphpを実行できるようにMIMEタイプの追加</p>
<p>[shell]</p>
<p>&amp;lt;IfModule mime_module&amp;gt;<br>…<br>AddType application/x-httpd-php .php<br>…<br>&amp;lt;/IfModule&amp;gt;</p>
<p>[/shell]</p>
<p>indexファイルにindex.phpを使えるように修正</p>
<p>[shell]</p>
<p>&amp;lt;IfModule dir_module&amp;gt;<br>…<br>DirectoryIndex index.html index.php<br>…<br>&amp;lt;/IfModule&amp;gt;</p>
<p>[/shell]</p>
<p>.htaccessでURLのoverwriteを許可</p>
<p>[shell]</p>
<p>&amp;lt;Directory &amp;quot;/usr/local/Cellar/httpd/2.2.22/share/apache2/htdocs&amp;quot;&amp;gt;<br>…<br>AllowOverride All<br>…<br>&amp;lt;/Directory&amp;gt;</p>
<p>[/shell]</p>
<p>このままでは起動時に<br>The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the log in /tmp/php-build.<strong>*</strong>.20130204001646.log のようなエラーがでるので、ログ用のディレクトリを追加します。</p>
<p>[shell]<br>$ mkdir /usr/local/Cellar/httpd/2.2.22/var/apache2/log<br>$ mkdir /usr/local/Cellar/httpd/2.2.22/var/apache2/run<br>[/shell]</p>
<p>これでApacheの設定はとりあえず終了</p>
<p>[shell]</p>
<h1 id="起動">起動</h1><p>$ sudo apachectl start</p>
<h1 id="停止">停止</h1><p>$ sudo apachectl stop</p>
<h1 id="再起動">再起動</h1><p>$ sudo apachectl restart</p>
<p>$ Apache version<br>$ httpd -v<br>Server version: Apache/2.2.22 (Unix)<br>Server built:   Aug 24 2012 17:16:58<br>[/shell]</p>
<h2 id="MySQL_install">MySQL install</h2><p>[shell]<br>$ brew install mysql<br>$ mysql_install_db —verbose -user=$(whoami) —basedir=&amp;quot;$(brew —prefix mysql)&amp;quot; —datadir=/usr/local/var/mysql —tmpdir=/tmp<br>[/shell]</p>
<h2 id="phpenvinstall">phpenvinstall</h2><p>続いて<a href="https://github.com/CHH/phpenv" target="_blank" rel="external">phpenv</a>のインストール。phpenvは<a href="https://github.com/sstephenson/rbenv/" target="_blank" rel="external">rbenv</a>を使って異なるバージョンのphpを管理するツール。</p>
<p>[shell]<br>$brew install —HEAD phpenv</p>
<h1 id="-bashrcなどに追加">.bashrcなどに追加</h1><p>$ vi ~/.bashrc<br>export PATH=&amp;quot;$HOME/.phpenv/bin:$PATH&amp;quot;<br>eval &amp;quot;$(phpenv init -)&amp;quot;</p>
<h1 id="設定したPATHの設定を有効にする">設定したPATHの設定を有効にする</h1><p>$ source ~/.bashrc<br>[/shell]</p>
<h2 id="php-build_install">php-build install</h2><p><a href="https://github.com/CHH/php-build" target="_blank" rel="external">php-build</a>は phpのダウンロードからインストールまでを行うツール</p>
<p>[shell]<br>$ brew install php-build</p>
<p>Add the following script block to <code>$HOME/.bashrc</code>, <code>$HOME/.zshrc</code>, or your shell’s equivalent configuration file.</p>
<p>Change <code>5.x.x</code> to the version of PHP you’d like your shell to default to or remove <code>php-version 5.x.x &amp;amp;amp;gt;/dev/null</code><br>if you do not wish to have a default version of PHP loaded into your <code>$PATH</code>. The large comment block is optional:</p>
<h6 id="#">#</h6><h1 id="php-version_(activate_default_PHP_version_and_autocompletion)">php-version (activate default PHP version and autocompletion)</h1><h1 id="PHP_HOME_=&amp;gt;_should_reflect_location_of_compiled_PHP_versions">PHP_HOME                      =&amp;gt; should reflect location of compiled PHP versions</h1><h1 id="PHPVERSION_DISABLE_COMPLETE=1_=&amp;gt;_to_disable_shell_completion">PHPVERSION_DISABLE_COMPLETE=1 =&amp;gt; to disable shell completion</h1><h6 id="#-1">#</h6><p>export PHP_VERSIONS=$(dirname $(brew —prefix php))<br>[ -f $(brew —prefix php-version)/php-version.sh ] &amp;amp;&amp;amp;<br>  source $(brew —prefix php-version)/php-version.sh &amp;amp;&amp;amp; php-version 5.x.x &amp;gt;/dev/null<br>/usr/local/Cellar/php-version/0.9.3: 3 files, 20K, built in 2 seconds</p>
<h1 id="php-buildのPATHを追加">php-buildのPATHを追加</h1><p>$ vi ~/.bashrc<br>export PATH=/usr/local/bin:$PATH</p>
<h1 id="設定したPATHの設定を有効にする-1">設定したPATHの設定を有効にする</h1><p>$ source ~/.bashrc<br>[/shell]</p>
<p>ダウンロードできるバージョンの確認</p>
<p>[shell]<br>$ php-build —definitions<br>5.2.17<br>5.3.10<br>5.3.11<br>5.3.11RC1<br>5.3.11RC2<br>5.3.12<br>5.3.13<br>5.3.14<br>5.3.15<br>5.3.2<br>5.3.3<br>5.3.6<br>5.3.8<br>5.3.9<br>5.3.9RC3<br>5.3.9RC4<br>5.3snapshot<br>5.4.0<br>5.4.0RC1<br>5.4.0RC2<br>5.4.0RC3<br>5.4.0RC4<br>5.4.0RC5<br>5.4.0RC6<br>5.4.0RC7<br>5.4.0RC8<br>5.4.0alpha3<br>5.4.0beta1<br>5.4.0beta2<br>5.4.1<br>5.4.1RC1<br>5.4.1RC2<br>5.4.2<br>5.4.3<br>5.4.4<br>5.4.5<br>5.4snapshot<br>[/shell]</p>
<p>php-buildはApacheのモジュールには対応してないようなので、Apacheのモジュールが生成されるように設定を変更します。<br>/usr/local/share/php-build/default_configure_options に以下を追加します。<br>[shell]</p>
<h1 id="以下の1行を追加">以下の1行を追加</h1><p>—with-apxs2=/usr/local/sbin/apxs<br>[/shell]</p>
<p>これでphpを自動で展開してモジュールも生成します。適当なphpをホームディレクトリ以下にinstallして展開します。</p>
<p>[shell]<br>$ php-build 5.4.5 ~/.phpenv/versions/5.4.5<br>[Info]: Loaded pyrus Plugin.<br>[Info]: Loaded xdebug Plugin.<br>[Info]: php.ini-production gets used as php.ini<br>[Info]: Building 5.4.0 into /Users/<em>*</em>/.phpenv/versions/5.4.5<br>[/shell]</p>
<p>おそらくmake時にいろいろとエラーが出るので、その都度解決してあげる必要があります。</p>
<p>[shell]</p>
<h2 id="#_エラーが出た"># エラーが出た</h2><h2 id="configure:_warning:_You_will_need_re2c_0-13-4_or_later_if_you_want_to_regenerate_PHP_parsers-_-/configure:_line_6372:_/usr/local/sbin/apxs:_No_such_file_or_directory_configure:_error:_Aborting">configure: warning: You will need re2c 0.13.4 or later if you want to regenerate PHP parsers. ./configure: line 6372: /usr/local/sbin/apxs: No such file or directory configure: error: Aborting</h2><h1 id="追加">追加</h1><p>$ brew install re2c</p>
<h2 id="#_エラーが出た-1"># エラーが出た</h2><h2 id="configure:_error:_png-h_not_found-">configure: error: png.h not found.</h2><h1 id="追加-1">追加</h1><p>$ brew install libpng</p>
<h2 id="#_エラーが出た-2"># エラーが出た</h2><h2 id="configure:_error:_mcrypt-h_not_found-_Please_reinstall_libmcrypt-">configure: error: mcrypt.h not found. Please reinstall libmcrypt.</h2><h1 id="追加-2">追加</h1><p>$ brew install libmcrypt</p>
<h1 id="そして改めて">そして改めて</h1><p>$ php-build 5.4.5 ~/.phpenv/versions/5.4.5<br>[Info]: Loaded pyrus Plugin.<br>[Info]: Loaded xdebug Plugin.<br>[Info]: php.ini-production gets used as php.ini<br>[Info]: Building 5.4.5 into /Users/<strong><em>/.phpenv/versions/5.4.5<br>[Skipping]: Already downloaded and extracted <a href="http://www.php.net/distributions/php-5.4.5.tar.bz2" target="_blank" rel="external">http://www.php.net/distributions/php-5.4.5.tar.bz2</a><br>[Pyrus]: Downloading from <a href="http://pear2.php.net/pyrus.phar" target="_blank" rel="external">http://pear2.php.net/pyrus.phar</a><br>[Pyrus]: Installing executable in /Users/</em></strong>/.phpenv/versions/5.4.5/bin/pyrus<br>[XDebug]: Downloading <a href="http://xdebug.org/files/xdebug-2.2.0.tgz" target="_blank" rel="external">http://xdebug.org/files/xdebug-2.2.0.tgz</a><br>[XDebug]: Compiling in /var/tmp/php-build/source/xdebug-2.2.0<br>[XDebug]: Installing XDebug configuration in /Users/<em>*</em>/.phpenv/versions/5.4.5/etc/conf.d/xdebug.ini<br>[XDebug]: Cleaning up.<br>[Info]: The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the log in /tmp/php-build.5.4.5.20130201001646.log<br>[Success]: Built 5.4.5 successfully.<br>[/shell]</p>
<p>ちなみに、後ほどモジュールの切替をおこなうのでインストールしたモジュールは退避させておきます。</p>
<p>[shell]</p>
<h1 id="libphp5-so_を退避しておく">libphp5.so を退避しておく</h1><p>$ mv /usr/local/Cellar/httpd/2.2.22/libexec/libphp5.so ~/.phpenv/versions/5.4.5<br>[/shell]</p>
<p>phpenvで確認</p>
<p>[shell]<br>$ phpenv versions</p>
<ul>
<li>system (set by /Users/<em>*</em>/.phpenv/version)<br>5.4.5<br>[/shell]</li>
</ul>
<p>system はあらかじめmacに入っているphpです。<br>php-buildでインストールしたphpはユーザーのホームディレクトリの.phpenvディレクトリに展開されてます。</p>
<p>[shell]</p>
<h1 id="ユーザーのホームディレクトリ">ユーザーのホームディレクトリ</h1><p>.phpenv/<br>  |—versions<br>      |—5.4.5<br>[/shell]</p>
<p>そしてphpのバージョンを切替え</p>
<p>[shell]<br>$ phpenv global 5.4.5</p>
<h1 id="バージョン確認">バージョン確認</h1><p>$ php -v<br>PHP 5.4.5 (cli) (built: Feb  1 2013 00:21:44)<br>Copyright (c) 1997-2012 The PHP Group<br>Zend Engine v2.4.0, Copyright (c) 1998-2012 Zend Technologies<br>    with Xdebug v2.2.0, Copyright (c) 2002-2012, by Derick Rethan<br>[/shell]</p>
<p>これでphpのバージョンは切替りました。<br>では、DocumentRoot にphpinfo()を実行するファイルをおいて、バージョンが切替っていることを確認。</p>
<p>が、こちらでは変わってない。<br>これは、phpenvはApacheのphpモジュールの切替えを行わないので、Apacheのphpは切り替わってません。<br>ということで、Apacheのモジュール切替スクリプト(rbenv-apache-version)を追加します。</p>
<p>[shell]</p>
<h1 id="~/-phpenv/libexec/rbenv-apache-version">~/.phpenv/libexec/rbenv-apache-version</h1><h1 id="!/usr/bin/env_bash">!/usr/bin/env bash</h1><p>set -e<br>[ -n &amp;quot;$RBENV_DEBUG&amp;quot; ] &amp;amp;&amp;amp; set -x</p>
<h1 id="Provide_rbenv_completions">Provide rbenv completions</h1><p>if [ &amp;quot;$1&amp;quot; = &amp;quot;—complete&amp;quot; ]; then<br>  echo system<br>  exec rbenv-versions —bare<br>fi</p>
<p>RBENV_VERSION=&amp;quot;$1&amp;quot;<br>RBENV_ON_FILE=&amp;quot;${RBENV_ROOT}/versions&amp;quot;<br>APACHE_ROOT=&amp;quot;/usr/local/Cellar/httpd/2.2.22&amp;quot;<br>APACHE_MODULE_PATH=&amp;quot;${APACHE_ROOT}/libexec&amp;quot;</p>
<h1 id="Make_sure_the_specified_version_is_installed-">Make sure the specified version is installed.</h1><p>RBENV_PREFIX_PATH=&amp;quot;${RBENV_ROOT}/versions/${RBENV_VERSION}&amp;quot;<br>if [ ! -d &amp;quot;$RBENV_PREFIX_PATH&amp;quot; ]; then<br>  echo &amp;quot;rbenv: version &#96;${RBENV_VERSION}’ not installed&amp;quot; &amp;gt;&amp;amp;2<br>  exit 1<br>fi</p>
<p>PHP_MODULE_PATH=&amp;quot;$RBENV_PREFIX_PATH/libphp5.so&amp;quot;</p>
<p>if [ ! -f &amp;quot;$PHP_MODULE_PATH&amp;quot; ]; then<br>  echo &amp;quot;apache module not found \’${PHP_MODULE_PATH}’&amp;quot; &amp;gt;&amp;amp;2<br>  exit 1<br>fi</p>
<p>if [ ! -d &amp;quot;$APACHE_MODULE_PATH&amp;quot; ]; then<br>  echo &amp;quot;Directory not found \’${APACHE_MODULE_PATH}’&amp;quot; &amp;gt;&amp;amp;2<br>  exit 1<br>fi</p>
<p>echo &amp;quot;copy ${PHP_MODULE_PATH} to ${APACHE_MODULE_PATH}&amp;quot;<br>cp &amp;quot;$PHP_MODULE_PATH&amp;quot; &amp;quot;$APACHE_MODULE_PATH&amp;quot;</p>
<p>echo &amp;quot;Restarting apache…&amp;quot;<br>sudo apachectl restart<br>[/shell]</p>
<p>実行権限を付与して、phpの切替えとApacheのモジュールの切替えを行います。</p>
<p>[shell]<br>chmod 755 /Users/<strong><em>/.phpenv/libexec/rbenv-apache-version<br>$ phpenv global 5.4.5<br>$ phpenv apache-version 5.4.5<br>copy /Users/</em></strong>/.phpenv/versions/5.4.5/libphp5.so to /usr/local/Cellar/httpd/2.2.22/libexec<br>Restarting apache…<br>Password:<br>[/shell]</p>
<p>Apacheが再起動して、モジュールが読込まれるとphpのバージョン切替ができます。<br>ちなみにphp5.4.0からはビルトインサーバーもあるので、そちらを使えばApacheのモジュール切替は不要です。</p>
<p>[shell]</p>
<h1 id="適当なディレクトリにおいて">適当なディレクトリにおいて</h1><p>$ php -S localhost:8080<br>PHP 5.4.5 Development Server started at Fri Feb  1 01:48:54 2013<br>Listening on localhost:8080<br>Document root is /Users/<em>*</em>/YOUR-APP-DIR<br>Press Ctrl-C to quit.<br>[/shell]</p>
<h2 id="composer_install">composer install</h2><p><a href="http://getcomposer.org/" target="_blank" rel="external">composer</a> は 外部ライブラリの依存管理ツール(PHP 5.3.2 or above)。<br>rubyでいうところのbundler、nodeでいうところのnpmみたいなものらしい。<br>登録されているパッケージは<a href="https://packagist.org" target="_blank" rel="external">Packagist</a>で検索できます。また、自身で作成したパッケージも登録できます。</p>
<p>[shell]</p>
<h1 id="globalにインストール">globalにインストール</h1><p>$ brew tap josegonzalez/homebrew-php<br>$ brew install josegonzalez/php/composer</p>
<h1 id="vendorを作成するディレクトリでphp_archiveファイル(composer-phar)をダウンロード">vendorを作成するディレクトリでphp archiveファイル(composer.phar)をダウンロード</h1><p>$ curl -s <a href="https://getcomposer.org/installer" target="_blank" rel="external">https://getcomposer.org/installer</a> | php<br>[/shell]</p>
<p>外部ライブラリはカレントディレクトリのcomposer.jsonで管理されます。<br>jsonファイルで定義したパッケージをautoloadしてくれます。</p>
<p>以下のような感じです。</p>
<p>[shell]<br>YOUR_PROJECT_DIR<br> |— vendor<br> |— composer.json<br> |— composer.phar<br>[/shell]</p>
<p>phpのユニットテストフレームワーク<a href="https://github.com/sebastianbergmann/phpunit/" target="_blank" rel="external">phpunit</a>と、インテグレーションテストフレームワーク<a href="http://codeception.com/" target="_blank" rel="external">codeception</a>をインストールしてみようと思います。<br>composer.jsonを別個で作成してもいいですが、対話式のパッケージ作成コマンドもあります。今回は対話式のパッケージ作成コマンドで<br>composer.jsonを作成してみます。</p>
<p>[shell]<br>$ composer init</p>
<p>Welcome to the Composer config generator</p>
<p>This command will guide you through creating your composer.json config.</p>
<h1 id="パッケージ名">パッケージ名</h1><p>Package name (&amp;lt;vendor&amp;gt;/&amp;lt;name&amp;gt;) [kazu69/t]: kazu69/TEST_APP</p>
<h1 id="パッケージの説明">パッケージの説明</h1><p>Description []: This app is TEST_APP</p>
<h1 id="パッケージの作者名">パッケージの作者名</h1><p>Author [kazu69 &amp;lt;<strong><strong>*</strong></strong>@gmail.com&amp;gt;]:</p>
<h1 id="安定性の説明_dev,_alpha,_beta,_RC,_and_stable">安定性の説明 dev, alpha, beta, RC, and stable</h1><p>Minimum Stability []: dev</p>
<p>Define your dependencies.</p>
<p>Would you like to define your dependencies (require) interactively [yes]?</p>
<h1 id="必要なパッケージとバージョン">必要なパッケージとバージョン</h1><p>Search for a package []: Codeception<br>Would you like to define your dev dependencies (require-dev) interactively [yes]?</p>
<h1 id="開発環境でパッケージに必要なパッケージとバージョン">開発環境でパッケージに必要なパッケージとバージョン</h1><p>Search for a package []: Codeception</p>
<h1 id="search_は非常に遅い">search は非常に遅い</h1><p>Found 33 packages matching Codeception/Codeception</p>
<p>[0] Codeception/Codeception 1.0.9<br>   [1] Codeception/Codeception 1.0.10<br>   [2] Codeception/Codeception 1.0.11<br>   [3] Codeception/Codeception 1.0.12<br>   [4] Codeception/Codeception 1.0.13<br>   [5] Codeception/Codeception 1.0.14<br>   [6] Codeception/Codeception 1.1.0<br>   [7] Codeception/Codeception 1.1.2<br>   [8] Codeception/Codeception 1.1.3<br>   [9] Codeception/Codeception 1.1.4<br>  [10] Codeception/Codeception 1.1.5<br>  [11] Codeception/Codeception 1.0.10<br>  [12] Codeception/Codeception 1.0.11<br>  [13] Codeception/Codeception 1.0.12<br>  [14] Codeception/Codeception 1.0.13<br>  [15] Codeception/Codeception 1.0.14<br>  [16] Codeception/Codeception 1.0.9<br>  [17] Codeception/Codeception 1.1.0<br>  [18] Codeception/Codeception 1.1.2<br>  [19] Codeception/Codeception 1.1.3<br>  [20] Codeception/Codeception 1.1.4<br>  [21] Codeception/Codeception 1.1.5</p>
<p>Enter package # to add, or a &amp;quot;[package] [version]&amp;quot; couple if it is not listed []: 0<br>Search for a package []: phpunit/phpunit</p>
<h1 id="search_は非常に遅い-1">search は非常に遅い</h1><p>Found 33 packages matching phpunit/phpunit</p>
<p>[0] phpunit/phpunit 3.7.0<br>   [1] phpunit/phpunit 3.7.1<br>   [2] phpunit/phpunit 3.7.10<br>   [3] phpunit/phpunit 3.7.2<br>   [4] phpunit/phpunit 3.7.3<br>   [5] phpunit/phpunit 3.7.4<br>   [6] phpunit/phpunit 3.7.5<br>   [7] phpunit/phpunit 3.7.6<br>   [8] phpunit/phpunit 3.7.7<br>   [9] phpunit/phpunit 3.7.8<br>  [10] phpunit/phpunit 3.7.9<br>  [11] phpunit/phpunit-mock-objects 1.2.0<br>  [12] phpunit/phpunit-mock-objects 1.2.1<br>  [13] phpunit/phpunit-mock-objects 1.2.2<br>  [14] phpunit/phpunit-selenium 1.2.10<br>  [15] phpunit/phpunit-selenium 1.2.11<br>  [16] phpunit/phpunit-selenium 1.2.9<br>  [17] phpunit/phpunit-story 1.0.1<br>  [18] phpunit/phpunit 3.7.11<br>  [19] phpunit/phpunit 3.7.12<br>  [20] phpunit/phpunit 3.7.13<br>  [21] phpunit/phpunit-mock-objects 1.2.3<br>  [22] phpunit/phpunit-selenium 1.2.12<br>  [23] phpunit/phpunit-selenium dev-master<br>  [24] phpunit/phpunit-story dev-master<br>  [25] phpunit/phpunit-mock-objects 1.2.x-dev<br>  [26] phpunit/phpunit-mock-objects dev-master<br>  [27] phpunit/phpunit-mock-objects 1.3.x-dev<br>  [28] phpunit/phpunit 3.7.x-dev<br>  [29] phpunit/phpunit dev-master<br>  [30] phpunit/phpunit 3.8.x-dev<br>  [31] phpunit/phpunit dev-refactoring<br>  [32] phpunit/phpunit dev-symfony-2.2</p>
<p>Enter package # to add, or a &amp;quot;[package] [version]&amp;quot; couple if it is not listed []: 0<br>Search for a package []:</p>
<p>{<br>    &amp;quot;name&amp;quot;: &amp;quot;kazu69/TEST_APP&amp;quot;,<br>    &amp;quot;description&amp;quot;: &amp;quot;This app is TEST_APP&amp;quot;,<br>    &amp;quot;require-dev&amp;quot;: {<br>        &amp;quot;codeception/codeception&amp;quot;: &amp;quot;1.0.9&amp;quot;,<br>        &amp;quot;phpunit/phpunit&amp;quot;: &amp;quot;3.7.0&amp;quot;<br>    },<br>    &amp;quot;minimum-stability&amp;quot;: &amp;quot;dev&amp;quot;,<br>    &amp;quot;authors&amp;quot;: [<br>        {<br>            &amp;quot;name&amp;quot;: &amp;quot;kazu69&amp;quot;,<br>            &amp;quot;email&amp;quot;: &amp;quot;<strong><strong>*</strong></strong>@gmail.com&amp;quot;<br>        }<br>    ],<br>    &amp;quot;require&amp;quot;: {</p>
<pre><code>}
</code></pre><p>}</p>
<p>Do you confirm generation [yes]?<br>Would you like the vendor directory added to your .gitignore [yes]?</p>
<p>[/shell]</p>
<p>という感じでcomposer.jsonを作成できます。<br>そのほかのcliのコマンドは<a href="http://getcomposer.org/doc/03-cli.md" target="_blank" rel="external">ドキュメント</a>にまとまってました。</p>
<p>必要なパッケージをインストールします</p>
<p>[shell]<br>$ composer install<br>Loading composer repositories with package information<br>Installing dependencies<br>Nothing to install or update<br>Generating autoload files<br>[/shell]</p>
<p>composer.lockとvendorディレクトリが作成されます。<br>パッケージはvendorディレクトリにインストールされます。<br>また、vendorにautoload.phpが作成されます。</p>
<p>[shell]<br>YOUR_PROJECT_DIR<br> |— .gitignore<br> |— composer.json<br> |— composer.phar<br> |— composer.lock<br> |— vendor<br>       |— autoload.php<br>       |— composer/<br>[/shell]</p>
<p>インストールしたライブラリを読込むのはこのautoload.phpをrequireすればいいということなので、とても簡単です。</p>
<p>[php]<br>require ‘vendor/autoload.php’;<br>[/php]</p>
<p>composer.lockファイルが生成された段階で、composer.jsonを変更した場合はupdateする必要があります。</p>
<p>[shell]</p>
<h1 id="インストールではなくupdate">インストールではなくupdate</h1><p>$ php composer.phar update<br>[/shell]</p>
<p>これまでのphpでの外部ライブラリ管理法とちがって、なんだかスッキリした感じです。</p>
<h2 id="Codeception_setup">Codeception setup</h2><p>折角なので、、インストールした<a href="http://codeception.com/" target="_blank" rel="external">Codeception</a>のQuickStartだけやってみます。<br>正直、Codeceptionについてまだ調べてないので、半分妄想レベル。<br>CodeceptionはPHP製のフルスタックのテストフレームワーク。<br>受け入れテスト、機能テスト、単体テストがこれだけでできる。Selenium, Mink, ZombieJSなどフロントのテスト機能もオールインワンっぽい。<a href="http://behat.org/" target="_blank" rel="external">Behat</a>やPHPUintをまとめて使えるようなもの。</p>
<p>ということで、やってみる。</p>
<p>[shell]</p>
<h1 id="dowunload">dowunload</h1><p>$ wget <a href="http://codeception.com/codecept.phar" target="_blank" rel="external">http://codeception.com/codecept.phar</a></p>
<h1 id="codeception-yml_と_テストディレクトリ作成">codeception.yml と テストディレクトリ作成</h1><p>$ php codecept.phar bootstrap</p>
<p>File codeception.yml written - global configuration<br>tests/unit created - unit tests<br>tests/functional created - functional tests<br>tests/acceptance created - acceptance tests<br>tests/unit.suite.yml written - unit tests suite configuration<br>tests/functional.suite.yml written - functional tests suite configuration<br>tests/acceptance.suite.yml written - acceptance tests suite configuration<br>Building initial Guy classes<br>/YOUR_PROJECT_DIR/tests/acceptance/WebGuy.php generated sucessfully. 25 methods added<br>/YOUR_PROJECT_DIR/tests/functional/TestGuy.php generated sucessfully. 9 methods added<br>/YOUR_PROJECT_DIR/tests/unit/CodeGuy.php generated sucessfully. 25 methods added</p>
<p>Bootstrap is done. Check out /tests directory</p>
<h1 id="テストを作成">テストを作成</h1><p>$ php codecept.phar generate:cept acceptance Welcome<br>Test was generated in WelcomeCept.php<br>[/shell]</p>
<p>生成したテストファイルを編集</p>
<p>[php]<br>$I = new WebGuy($scenario);<br>$I-&amp;gt;wantTo(‘ensure that frontpage works’);<br>$I-&amp;gt;amOnPage(‘/‘);<br>$I-&amp;gt;see(‘Home’);<br>[/php]</p>
<p>PhpBrowserのURLを自身のアプリのURLに変更</p>
<p>[xml]<br>class_name: WebGuy<br>modules:<br>  enabled:</p>
<pre><code>-<span class="ruby"> <span class="constant">PhpBrowser</span>
</span>-<span class="ruby"> <span class="constant">WebHelper</span></span>
</code></pre><p>  config:<br>    PhpBrowser:<br>      url: ‘<a href="http://localhost/" target="_blank" rel="external">http://localhost/</a>‘<br>[/xml]</p>
<p>テスト実行する。<br><a href="http://mink.behat.org/" target="_blank" rel="external">Mink</a>ベースのPhpBrowserというモジュールがinputの入力、リンククリックなどのUIテスト、post、getなどのアクセステストをするらしい。</p>
<p>[shell]<br>$ php codecept.phar run</p>
<p>Suite acceptance started<br>Trying to ensure that frontpage works (WelcomeCept.php) - Failed</p>
<p>Suite functional started</p>
<p>Suite unit started</p>
<p>Time: 0 seconds, Memory: 9.75Mb</p>
<p>There was 1 failure:</p>
<hr>
<p>1) Couldn’t ensure that frontpage works in WelcomeCept.php<br>Guy couldn’t see &amp;quot;Home&amp;quot;: ‘Home’ in It works!.<br>Failed asserting that response contains &amp;quot;home&amp;quot;. Response was saved to ‘log’ directory.</p>
<p>Scenario Steps:<br>2. I see &amp;quot;Home&amp;quot;<br>1. I am on page &amp;quot;/&amp;quot;</p>
<p>FAILURES!<br>Tests: 1, Assertions: 1, Failures: 1.</p>
<p>[/shell]</p>
<p>という感じでした。phpunitでテストを書くよりもわかりやすいのかな？と感じました。</p>
<p>というわけで、ザザーっと最近のphpの開発環境周りを見てきました。<br>なんか、自動化されてて思っていたより便利になってる気がします。</p>
<h2 id="参考記事">参考記事</h2><p><a href="http://starzero.hatenablog.com/entry/20120916/1347786793" target="_blank" rel="external">MacでApache、MySQL、PHPの環境を作る</a><br><a href="http://creator-life.net/modern-php-env/" target="_blank" rel="external">モダンなPHP開発環境を構築する</a><br><a href="http://blog.dataich.com/2012/01/11/multiple-versions-php-phpenv-phpbuild-pyrus/" target="_blank" rel="external">phpenv+php-build+pyrusでの複数バージョンPHP管理など</a><br><a href="http://www.ryuzee.com/contents/blog/5681" target="_blank" rel="external">PHPの外部ライブラリの管理にComposerを使う</a><br><a href="http://codeception.com/blog" target="_blank" rel="external">codeception blog</a></p>

    
  </div>

  
    <footer class="article-footer">
      <a data-url="http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/" data-id="ciabxce0r00883sp4rb8t77go" class="article-share-link">Share</a>
      
        <a href="http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  

  
    
<nav id="article-nav">
  <div class="article-nav">
    
      <a href="/2013/03/01/rails-project-uses-a-javascript-package-management-tool-bower/" id="article-nav-newer" class="article-nav-link article-nav-link-newer">
        <span class="article-nav-caption">Newer - </span>
        <span class="article-nav-title">
          
            railsプロジェクトでjavascriptのパッケージ管理ツールBowerを使う
          
        </span>
      </a>
    
    
      <a href="/2013/01/10/grunt-jasmine-headless-unit-test/" id="article-nav-older" class="article-nav-link article-nav-link-older">
        <span class="article-nav-caption">Older - </span>
        <span class="article-nav-title">
          
            GruntでJasmineを使ったHeadlessなユニットテスト
          
        </span>
        </span>
      </a>
    
  </div>
</nav>

  
</article>


  <aside>
    
<!-- Google Adsence -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-4054575508733221"
   data-ad-slot="9493597992"
   data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<!-- End Google Adsence -->


  </aside>



<section class="comments" id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
      
    </main>
    <footer id="footer" role="contentinfo">
  
  <div class="footer-cotent">
    <small>&copy; 2015 kazu69</small>
    <span class="generator">Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></span>
  </div>
</footer>
    
<script>
  var disqus_shortname = '69log';
  
  var disqus_url = 'http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

</body>
</html>