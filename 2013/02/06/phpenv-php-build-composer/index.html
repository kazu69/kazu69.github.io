<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>phpenv + php-build + composer で開発環境作ってみた | 69log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。">
<meta property="og:type" content="article">
<meta property="og:title" content="phpenv + php-build + composer で開発環境作ってみた">
<meta property="og:url" content="http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/index.html">
<meta property="og:site_name" content="69log">
<meta property="og:description" content="以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。">
<meta property="og:updated_time" content="2016-09-19T08:46:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="phpenv + php-build + composer で開発環境作ってみた">
<meta name="twitter:description" content="以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。">
  
    <link rel="alternative" href="/atom.xml" title="69log" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-9196861-14', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
    <header role="header">
  <div class="header cf">
    <div class="title-content">
      <h1>
        <a href="/">69log</a>
      </h1>
      
        <h2>
          <a href="/">福岡でwebの仕事をしています</a>
        </h2>
      
    </div>

    <div class="nav-content cf">
      <nav>
        
          <a href="/" class="nav-link nav-home">home</a>
        
          <a href="/archives" class="nav-link nav-archives">archives</a>
        
        
          <a href="/atom.xml" title="RSS Feed" class="icon nav-link nav-feed"></a>
        
      </nav>
      <div class="header-search">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://blog.kazu69.net"></form>
      </div>
    </div>
  </div>
</header>

    <main role="main" id="main">
      <section><article id="post-phpenv-php-build-composer" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    
      
  
    <h1 class="article-title" itemprop="name">
      phpenv + php-build + composer で開発環境作ってみた
    </h1>
  

    
    <div class="article-meta clr">
      <time datetime="2013-02-06T10:11:56.000Z" itemprop="datePublished">2013-02-06</time>

      
  <div class="article-category">
    <a class="article-category-link" href="/categories/memo/">memo</a>
  </div>


    </div>
  </header>

  <div class="article-entry" itemprop="articleBody">
    <div class="article-gallery">
      
    </div>
    
      <p>以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。<br><a id="more"></a></p>
<h2 id="Apache-install"><a href="#Apache-install" class="headerlink" title="Apache install"></a>Apache install</h2><p>自分のmac(Mac10.8)ではあらかじめApacheは入っているのですが、せっかくなのでApache installから。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ brew tap Homebrew/dupes</div><div class="line">$ brew install httpd</div></pre></td></tr></table></figure>
<p>ApacheやPHPは<a href="http://mxcl.github.com/homebrew/" target="_blank" rel="external">homebrew</a>のFormulaでは管理されてないのですが、Homebrewに新たに追加されたtapコマンド使うことで任意のFormulaを追加できるらしい。<br>ちなみにtapが使えないときは<a href="https://github.com/mxcl/homebrew/wiki/FAQ" target="_blank" rel="external">brewのupdate</a>が必要。</p>
<p>続いてhttpd.confの設定</p>
<p>/usr/local/Cellar/httpd/2.2.22/etc/apache2/httpd.conf の 155行目付近</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># ServerName gives the name and port that the server uses to identify itself.</div><div class="line"></div><div class="line"># This can often be determined automatically, but we recommend you specify</div><div class="line"></div><div class="line"># it explicitly to prevent problems during startup.</div><div class="line"></div><div class="line">#</div><div class="line"></div><div class="line"># If your host doesn&apos;t have a registered DNS name, enter its IP address here.</div><div class="line"></div><div class="line">#</div><div class="line"></div><div class="line">ServerName localhost:80</div></pre></td></tr></table></figure>
<p>DocumentRootを変更するならば、</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#</div><div class="line"></div><div class="line"># DocumentRoot: The directory out of which you will serve your</div><div class="line"></div><div class="line"># documents. By default, all requests are taken from this directory, but</div><div class="line"></div><div class="line"># symbolic links and aliases may be used to point to other locations.</div><div class="line"></div><div class="line">#</div><div class="line">DocumentRoot &quot;/Library/WebServer/Documents/&quot;</div></pre></td></tr></table></figure>
<p>php5のモジュールはコメントアウトされているときはコメントアウトを削除しておく</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LoadModule php5_module libexec/libphp5.so</div></pre></td></tr></table></figure>
<p>.phpでphpを実行できるようにMIMEタイプの追加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;IfModule mime_module&gt;</div><div class="line">…</div><div class="line">AddType application/x-httpd-php .php</div><div class="line">…</div><div class="line">&lt;/IfModule&gt;</div></pre></td></tr></table></figure>
<p>indexファイルにindex.phpを使えるように修正</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;IfModule dir_module&gt;</div><div class="line">…</div><div class="line">DirectoryIndex index.html index.php</div><div class="line">…</div><div class="line">&lt;/IfModule&gt;</div></pre></td></tr></table></figure>
<p>.htaccessでURLのoverwriteを許可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Directory &quot;/usr/local/Cellar/httpd/2.2.22/share/apache2/htdocs&quot;&gt;</div><div class="line">…</div><div class="line">AllowOverride All</div><div class="line">…</div><div class="line">&lt;/Directory&gt;</div></pre></td></tr></table></figure>
<p>このままでは起動時に<br>The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the log in /tmp/php-build.<strong>*</strong>.20130204001646.log のようなエラーがでるので、ログ用のディレクトリを追加します。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ mkdir /usr/<span class="built_in">local</span>/Cellar/httpd/2.2.22/var/apache2/<span class="built_in">log</span></div><div class="line">$ mkdir /usr/<span class="built_in">local</span>/Cellar/httpd/2.2.22/var/apache2/run</div></pre></td></tr></table></figure>
<p>これでApacheの設定はとりあえず終了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 起動</span></div><div class="line">$ sudo apachectl start</div><div class="line"></div><div class="line"><span class="comment"># 停止</span></div><div class="line">$ sudo apachectl stop</div><div class="line"></div><div class="line"><span class="comment"># 再起動</span></div><div class="line">$ sudo apachectl restart</div><div class="line"></div><div class="line">$ Apache version</div><div class="line">$ httpd -v</div><div class="line">Server version: Apache/2.2.22 (Unix)</div><div class="line">Server built:   Aug 24 2012 17:16:58</div></pre></td></tr></table></figure>
<h2 id="MySQL-install"><a href="#MySQL-install" class="headerlink" title="MySQL install"></a>MySQL install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ brew install mysql</div><div class="line">$ mysql_install_db --verbose -user=$(whoami) --basedir=<span class="string">"<span class="variable">$(brew --prefix mysql)</span>"</span> --datadir=/usr/<span class="built_in">local</span>/var/mysql --tmpdir=/tmp</div></pre></td></tr></table></figure>
<h2 id="phpenvinstall"><a href="#phpenvinstall" class="headerlink" title="phpenvinstall"></a>phpenvinstall</h2><p>続いて<a href="https://github.com/CHH/phpenv" target="_blank" rel="external">phpenv</a>のインストール。phpenvは<a href="https://github.com/sstephenson/rbenv/" target="_blank" rel="external">rbenv</a>を使って異なるバージョンのphpを管理するツール。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$brew</span> install --HEAD phpenv</div><div class="line"></div><div class="line"><span class="comment"># .bashrcなどに追加</span></div><div class="line">$ vi ~/.bashrc</div><div class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$HOME</span>/.phpenv/bin:<span class="variable">$PATH</span>"</span></div><div class="line"><span class="built_in">eval</span> <span class="string">"<span class="variable">$(phpenv init -)</span>"</span></div><div class="line"></div><div class="line"><span class="comment"># 設定したPATHの設定を有効にする</span></div><div class="line">$ <span class="built_in">source</span> ~/.bashrc</div></pre></td></tr></table></figure>
<h2 id="php-build-install"><a href="#php-build-install" class="headerlink" title="php-build install"></a>php-build install</h2><p><a href="https://github.com/CHH/php-build" target="_blank" rel="external">php-build</a>は phpのダウンロードからインストールまでを行うツール</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">$ brew install php-build</div><div class="line"></div><div class="line">Add the following script block to `<span class="variable">$HOME</span>/.bashrc`, `<span class="variable">$HOME</span>/.zshrc`, or your shell<span class="string">'s equivalent configuration file.</span></div><div class="line"></div><div class="line">Change `5.x.x` to the version of PHP you'd like your shell to default to or remove `php-version 5.x.x &amp;gt;/dev/null`</div><div class="line"><span class="keyword">if</span> you <span class="keyword">do</span> not wish to have a default version of PHP loaded into your `<span class="variable">$PATH</span>`. The large comment block is optional:</div><div class="line"></div><div class="line"><span class="comment">###### #</span></div><div class="line"></div><div class="line"><span class="comment"># php-version (activate default PHP version and autocompletion)</span></div><div class="line"></div><div class="line"><span class="comment"># PHP_HOME                      =&gt; should reflect location of compiled PHP versions</span></div><div class="line"></div><div class="line"><span class="comment"># PHPVERSION_DISABLE_COMPLETE=1 =&gt; to disable shell completion</span></div><div class="line"></div><div class="line"><span class="comment">###### #</span></div><div class="line"></div><div class="line"><span class="built_in">export</span> PHP_VERSIONS=$(dirname $(brew --prefix php))</div><div class="line">[ -f $(brew --prefix php-version)/php-version.sh ] &amp;&amp;</div><div class="line">  <span class="built_in">source</span> $(brew --prefix php-version)/php-version.sh &amp;&amp; php-version 5.x.x &gt;/dev/null</div><div class="line">/usr/<span class="built_in">local</span>/Cellar/php-version/0.9.3: 3 files, 20K, built <span class="keyword">in</span> 2 seconds</div><div class="line"></div><div class="line"><span class="comment"># php-buildのPATHを追加</span></div><div class="line"></div><div class="line">$ vi ~/.bashrc</div><div class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/bin:<span class="variable">$PATH</span></div><div class="line"></div><div class="line"><span class="comment"># 設定したPATHの設定を有効にする</span></div><div class="line"></div><div class="line">$ <span class="built_in">source</span> ~/.bashrc</div></pre></td></tr></table></figure>
<p>ダウンロードできるバージョンの確認</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">$ php-build --definitions</div><div class="line">5.2.17</div><div class="line">5.3.10</div><div class="line">5.3.11</div><div class="line">5.3.11RC1</div><div class="line">5.3.11RC2</div><div class="line">5.3.12</div><div class="line">5.3.13</div><div class="line">5.3.14</div><div class="line">5.3.15</div><div class="line">5.3.2</div><div class="line">5.3.3</div><div class="line">5.3.6</div><div class="line">5.3.8</div><div class="line">5.3.9</div><div class="line">5.3.9RC3</div><div class="line">5.3.9RC4</div><div class="line">5.3snapshot</div><div class="line">5.4.0</div><div class="line">5.4.0RC1</div><div class="line">5.4.0RC2</div><div class="line">5.4.0RC3</div><div class="line">5.4.0RC4</div><div class="line">5.4.0RC5</div><div class="line">5.4.0RC6</div><div class="line">5.4.0RC7</div><div class="line">5.4.0RC8</div><div class="line">5.4.0alpha3</div><div class="line">5.4.0beta1</div><div class="line">5.4.0beta2</div><div class="line">5.4.1</div><div class="line">5.4.1RC1</div><div class="line">5.4.1RC2</div><div class="line">5.4.2</div><div class="line">5.4.3</div><div class="line">5.4.4</div><div class="line">5.4.5</div><div class="line">5.4snapshot</div></pre></td></tr></table></figure>
<p>php-buildはApacheのモジュールには対応してないようなので、Apacheのモジュールが生成されるように設定を変更します。<br>/usr/local/share/php-build/default_configure_options に以下を追加します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 以下の1行を追加</div><div class="line">--with-apxs2=/usr/local/sbin/apxs</div></pre></td></tr></table></figure>
<p>これでphpを自動で展開してモジュールも生成します。適当なphpをホームディレクトリ以下にinstallして展開します。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ php-build 5.4.5 ~/.phpenv/versions/5.4.5</div><div class="line">[Info]: Loaded pyrus Plugin.</div><div class="line">[Info]: Loaded xdebug Plugin.</div><div class="line">[Info]: php.ini-production gets used as php.ini</div><div class="line">[Info]: Building 5.4.0 into /Users/***/.phpenv/versions/5.4.5</div></pre></td></tr></table></figure>
<p>おそらくmake時にいろいろとエラーが出るので、その都度解決してあげる必要があります。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## # エラーが出た</span></div><div class="line"><span class="comment">## configure: warning: You will need re2c 0.13.4 or later if you want to regenerate PHP parsers. ./configure: line 6372: /usr/local/sbin/apxs: No such file or directory configure: error: Aborting</span></div><div class="line"></div><div class="line"><span class="comment"># 追加</span></div><div class="line">$ brew install re2c</div><div class="line"></div><div class="line"><span class="comment">## # エラーが出た</span></div><div class="line"><span class="comment">## configure: error: png.h not found.</span></div><div class="line"><span class="comment"># 追加</span></div><div class="line">$ brew install libpng</div><div class="line"></div><div class="line"><span class="comment">## # エラーが出た</span></div><div class="line"><span class="comment">## configure: error: mcrypt.h not found. Please reinstall libmcrypt.</span></div><div class="line"><span class="comment"># 追加</span></div><div class="line">$ brew install libmcrypt</div><div class="line"></div><div class="line"><span class="comment"># そして改めて</span></div><div class="line">$ php-build 5.4.5 ~/.phpenv/versions/5.4.5</div><div class="line">[Info]: Loaded pyrus Plugin.</div><div class="line">[Info]: Loaded xdebug Plugin.</div><div class="line">[Info]: php.ini-production gets used as php.ini</div><div class="line">[Info]: Building 5.4.5 into /Users/**_/.phpenv/versions/5.4.5</div><div class="line">[Skipping]: Already downloaded and extracted http://www.php.net/distributions/php-5.4.5.tar.bz2</div><div class="line">[Pyrus]: Downloading from http://pear2.php.net/pyrus.phar</div><div class="line">[Pyrus]: Installing executable <span class="keyword">in</span> /Users/_**/.phpenv/versions/5.4.5/bin/pyrus</div><div class="line">[XDebug]: Downloading http://xdebug.org/files/xdebug-2.2.0.tgz</div><div class="line">[XDebug]: Compiling <span class="keyword">in</span> /var/tmp/php-build/<span class="built_in">source</span>/xdebug-2.2.0</div><div class="line">[XDebug]: Installing XDebug configuration <span class="keyword">in</span> /Users/***/.phpenv/versions/5.4.5/etc/conf.d/xdebug.ini</div><div class="line">[XDebug]: Cleaning up.</div><div class="line">[Info]: The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the <span class="built_in">log</span> <span class="keyword">in</span> /tmp/php-build.5.4.5.20130201001646.log</div><div class="line">[Success]: Built 5.4.5 successfully.</div></pre></td></tr></table></figure>
<p>ちなみに、後ほどモジュールの切替をおこなうのでインストールしたモジュールは退避させておきます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># libphp5.so を退避しておく</span></div><div class="line">$ mv /usr/<span class="built_in">local</span>/Cellar/httpd/2.2.22/libexec/libphp5.so ~/.phpenv/versions/5.4.5</div></pre></td></tr></table></figure>
<p>phpenvで確認</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ phpenv versions</div><div class="line">* system (<span class="built_in">set</span> by /Users/***/.phpenv/version)</div><div class="line">  5.4.5</div></pre></td></tr></table></figure>
<p>system はあらかじめmacに入っているphpです。<br>php-buildでインストールしたphpはユーザーのホームディレクトリの.phpenvディレクトリに展開されてます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># ユーザーのホームディレクトリ</span></div><div class="line"></div><div class="line">.phpenv/</div><div class="line">  |--versions</div><div class="line">      |--5.4.5</div></pre></td></tr></table></figure>
<p>そしてphpのバージョンを切替え</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ phpenv global 5.4.5</div><div class="line"></div><div class="line"><span class="comment"># バージョン確認</span></div><div class="line">$ php -v</div><div class="line">PHP 5.4.5 (cli) (built: Feb  1 2013 00:21:44) </div><div class="line">Copyright (c) 1997-2012 The PHP Group</div><div class="line">Zend Engine v2.4.0, Copyright (c) 1998-2012 Zend Technologies</div><div class="line">    with Xdebug v2.2.0, Copyright (c) 2002-2012, by Derick Rethan</div></pre></td></tr></table></figure>
<p>これでphpのバージョンは切替りました。<br>では、DocumentRoot にphpinfo()を実行するファイルをおいて、バージョンが切替っていることを確認。</p>
<p>が、こちらでは変わってない。<br>これは、phpenvはApacheのphpモジュールの切替えを行わないので、Apacheのphpは切り替わってません。<br>ということで、Apacheのモジュール切替スクリプト(rbenv-apache-version)を追加します。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ~/.phpenv/libexec/rbenv-apache-version</span></div><div class="line"><span class="comment"># !/usr/bin/env bash</span></div><div class="line"></div><div class="line"><span class="built_in">set</span> -e</div><div class="line">[ -n <span class="string">"<span class="variable">$RBENV_DEBUG</span>"</span> ] &amp;&amp; <span class="built_in">set</span> -x</div><div class="line"></div><div class="line"><span class="comment"># Provide rbenv completions</span></div><div class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> = <span class="string">"--complete"</span> ]; <span class="keyword">then</span></div><div class="line">  <span class="built_in">echo</span> system</div><div class="line">  <span class="built_in">exec</span> rbenv-versions --bare</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">RBENV_VERSION=<span class="string">"<span class="variable">$1</span>"</span></div><div class="line">RBENV_ON_FILE=<span class="string">"<span class="variable">$&#123;RBENV_ROOT&#125;</span>/versions"</span></div><div class="line">APACHE_ROOT=<span class="string">"/usr/local/Cellar/httpd/2.2.22"</span></div><div class="line">APACHE_MODULE_PATH=<span class="string">"<span class="variable">$&#123;APACHE_ROOT&#125;</span>/libexec"</span></div><div class="line"></div><div class="line"><span class="comment"># Make sure the specified version is installed.</span></div><div class="line">RBENV_PREFIX_PATH=<span class="string">"<span class="variable">$&#123;RBENV_ROOT&#125;</span>/versions/<span class="variable">$&#123;RBENV_VERSION&#125;</span>"</span></div><div class="line"><span class="keyword">if</span> [ ! -d <span class="string">"<span class="variable">$RBENV_PREFIX_PATH</span>"</span> ]; <span class="keyword">then</span></div><div class="line">  <span class="built_in">echo</span> <span class="string">"rbenv: version '<span class="variable">$&#123;RBENV_VERSION&#125;</span>' not installed"</span> &gt;&amp;2</div><div class="line">  <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">PHP_MODULE_PATH=<span class="string">"<span class="variable">$RBENV_PREFIX_PATH</span>/libphp5.so"</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ ! -f <span class="string">"<span class="variable">$PHP_MODULE_PATH</span>"</span> ]; <span class="keyword">then</span></div><div class="line">  <span class="built_in">echo</span> <span class="string">"apache module not found \'<span class="variable">$&#123;PHP_MODULE_PATH&#125;</span>'"</span> &gt;&amp;2</div><div class="line">  <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ ! -d <span class="string">"<span class="variable">$APACHE_MODULE_PATH</span>"</span> ]; <span class="keyword">then</span></div><div class="line">  <span class="built_in">echo</span> <span class="string">"Directory not found \'<span class="variable">$&#123;APACHE_MODULE_PATH&#125;</span>'"</span> &gt;&amp;2</div><div class="line">  <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"copy <span class="variable">$&#123;PHP_MODULE_PATH&#125;</span> to <span class="variable">$&#123;APACHE_MODULE_PATH&#125;</span>"</span></div><div class="line">cp <span class="string">"<span class="variable">$PHP_MODULE_PATH</span>"</span> <span class="string">"<span class="variable">$APACHE_MODULE_PATH</span>"</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"Restarting apache..."</span></div><div class="line">sudo apachectl restart</div></pre></td></tr></table></figure>
<p>実行権限を付与して、phpの切替えとApacheのモジュールの切替えを行います。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">chmod 755 /Users/**_/.phpenv/libexec/rbenv-apache-version</div><div class="line">$ phpenv global 5.4.5</div><div class="line">$ phpenv apache-version 5.4.5</div><div class="line">copy /Users/_**/.phpenv/versions/5.4.5/libphp5.so to /usr/<span class="built_in">local</span>/Cellar/httpd/2.2.22/libexec</div><div class="line">Restarting apache...</div><div class="line">Password:</div></pre></td></tr></table></figure>
<p>Apacheが再起動して、モジュールが読込まれるとphpのバージョン切替ができます。<br>ちなみにphp5.4.0からはビルトインサーバーもあるので、そちらを使えばApacheのモジュール切替は不要です。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 適当なディレクトリにおいて</span></div><div class="line">$ php -S localhost:8080</div><div class="line">PHP 5.4.5 Development Server started at Fri Feb  1 01:48:54 2013</div><div class="line">Listening on localhost:8080</div><div class="line">Document root is /Users/***/YOUR-APP-DIR</div><div class="line">Press Ctrl-C to quit.</div></pre></td></tr></table></figure>
<h2 id="composer-install"><a href="#composer-install" class="headerlink" title="composer install"></a>composer install</h2><p><a href="http://getcomposer.org/" target="_blank" rel="external">composer</a> は 外部ライブラリの依存管理ツール(PHP 5.3.2 or above)。<br>rubyでいうところのbundler、nodeでいうところのnpmみたいなものらしい。<br>登録されているパッケージは<a href="https://packagist.org" target="_blank" rel="external">Packagist</a>で検索できます。また、自身で作成したパッケージも登録できます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># globalにインストール</span></div><div class="line">$ brew tap josegonzalez/homebrew-php</div><div class="line">$ brew install josegonzalez/php/composer</div><div class="line"></div><div class="line"><span class="comment"># vendorを作成するディレクトリでphp archiveファイル(composer.phar)をダウンロード</span></div><div class="line">$ curl -s https://getcomposer.org/installer | php</div></pre></td></tr></table></figure>
<p>外部ライブラリはカレントディレクトリのcomposer.jsonで管理されます。<br>jsonファイルで定義したパッケージをautoloadしてくれます。</p>
<p>以下のような感じです。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">YOUR_PROJECT_DIR</div><div class="line"> |-- vendor</div><div class="line"> |-- composer.json</div><div class="line"> |-- composer.phar</div></pre></td></tr></table></figure>
<p>phpのユニットテストフレームワーク<a href="https://github.com/sebastianbergmann/phpunit/" target="_blank" rel="external">phpunit</a>と、インテグレーションテストフレームワーク<a href="http://codeception.com/" target="_blank" rel="external">codeception</a>をインストールしてみようと思います。<br>composer.jsonを別個で作成してもいいですが、対話式のパッケージ作成コマンドもあります。今回は対話式のパッケージ作成コマンドで<br>composer.jsonを作成してみます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line">$ composer init</div><div class="line"></div><div class="line">Welcome to the Composer config generator</div><div class="line"></div><div class="line">This <span class="built_in">command</span> will guide you through creating your composer.json config.</div><div class="line"></div><div class="line"><span class="comment"># パッケージ名</span></div><div class="line">Package name (&lt;vendor&gt;/&lt;name&gt;) [kazu69/t]: kazu69/TEST_APP</div><div class="line"></div><div class="line"><span class="comment"># パッケージの説明</span></div><div class="line">Description []: This app is TEST_APP</div><div class="line"></div><div class="line"><span class="comment"># パッケージの作者名</span></div><div class="line">Author [kazu69 &lt;*********@gmail.com&gt;]:</div><div class="line"></div><div class="line"><span class="comment"># 安定性の説明 dev, alpha, beta, RC, and stable</span></div><div class="line">Minimum Stability []: dev</div><div class="line"></div><div class="line">Define your dependencies.</div><div class="line"></div><div class="line">Would you like to define your dependencies (require) interactively [yes]?</div><div class="line"></div><div class="line"><span class="comment"># 必要なパッケージとバージョン</span></div><div class="line">Search <span class="keyword">for</span> a package []: Codeception</div><div class="line">Would you like to define your dev dependencies (require-dev) interactively [yes]?</div><div class="line"></div><div class="line"><span class="comment"># 開発環境でパッケージに必要なパッケージとバージョン</span></div><div class="line">Search <span class="keyword">for</span> a package []: Codeception</div><div class="line"></div><div class="line"><span class="comment"># search は非常に遅い</span></div><div class="line">Found 33 packages matching Codeception/Codeception</div><div class="line"></div><div class="line">[0] Codeception/Codeception 1.0.9</div><div class="line">   [1] Codeception/Codeception 1.0.10</div><div class="line">   [2] Codeception/Codeception 1.0.11</div><div class="line">   [3] Codeception/Codeception 1.0.12</div><div class="line">   [4] Codeception/Codeception 1.0.13</div><div class="line">   [5] Codeception/Codeception 1.0.14</div><div class="line">   [6] Codeception/Codeception 1.1.0</div><div class="line">   [7] Codeception/Codeception 1.1.2</div><div class="line">   [8] Codeception/Codeception 1.1.3</div><div class="line">   [9] Codeception/Codeception 1.1.4</div><div class="line">  [10] Codeception/Codeception 1.1.5</div><div class="line">  [11] Codeception/Codeception 1.0.10</div><div class="line">  [12] Codeception/Codeception 1.0.11</div><div class="line">  [13] Codeception/Codeception 1.0.12</div><div class="line">  [14] Codeception/Codeception 1.0.13</div><div class="line">  [15] Codeception/Codeception 1.0.14</div><div class="line">  [16] Codeception/Codeception 1.0.9</div><div class="line">  [17] Codeception/Codeception 1.1.0</div><div class="line">  [18] Codeception/Codeception 1.1.2</div><div class="line">  [19] Codeception/Codeception 1.1.3</div><div class="line">  [20] Codeception/Codeception 1.1.4</div><div class="line">  [21] Codeception/Codeception 1.1.5</div><div class="line"></div><div class="line">Enter package <span class="comment"># to add, or a "[package] [version]" couple if it is not listed []: 0</span></div><div class="line">Search <span class="keyword">for</span> a package []: phpunit/phpunit</div><div class="line"></div><div class="line"><span class="comment"># search は非常に遅い</span></div><div class="line">Found 33 packages matching phpunit/phpunit</div><div class="line"></div><div class="line">[0] phpunit/phpunit 3.7.0</div><div class="line">   [1] phpunit/phpunit 3.7.1</div><div class="line">   [2] phpunit/phpunit 3.7.10</div><div class="line">   [3] phpunit/phpunit 3.7.2</div><div class="line">   [4] phpunit/phpunit 3.7.3</div><div class="line">   [5] phpunit/phpunit 3.7.4</div><div class="line">   [6] phpunit/phpunit 3.7.5</div><div class="line">   [7] phpunit/phpunit 3.7.6</div><div class="line">   [8] phpunit/phpunit 3.7.7</div><div class="line">   [9] phpunit/phpunit 3.7.8</div><div class="line">  [10] phpunit/phpunit 3.7.9</div><div class="line">  [11] phpunit/phpunit-mock-objects 1.2.0</div><div class="line">  [12] phpunit/phpunit-mock-objects 1.2.1</div><div class="line">  [13] phpunit/phpunit-mock-objects 1.2.2</div><div class="line">  [14] phpunit/phpunit-selenium 1.2.10</div><div class="line">  [15] phpunit/phpunit-selenium 1.2.11</div><div class="line">  [16] phpunit/phpunit-selenium 1.2.9</div><div class="line">  [17] phpunit/phpunit-story 1.0.1</div><div class="line">  [18] phpunit/phpunit 3.7.11</div><div class="line">  [19] phpunit/phpunit 3.7.12</div><div class="line">  [20] phpunit/phpunit 3.7.13</div><div class="line">  [21] phpunit/phpunit-mock-objects 1.2.3</div><div class="line">  [22] phpunit/phpunit-selenium 1.2.12</div><div class="line">  [23] phpunit/phpunit-selenium dev-master</div><div class="line">  [24] phpunit/phpunit-story dev-master</div><div class="line">  [25] phpunit/phpunit-mock-objects 1.2.x-dev</div><div class="line">  [26] phpunit/phpunit-mock-objects dev-master</div><div class="line">  [27] phpunit/phpunit-mock-objects 1.3.x-dev</div><div class="line">  [28] phpunit/phpunit 3.7.x-dev</div><div class="line">  [29] phpunit/phpunit dev-master</div><div class="line">  [30] phpunit/phpunit 3.8.x-dev</div><div class="line">  [31] phpunit/phpunit dev-refactoring</div><div class="line">  [32] phpunit/phpunit dev-symfony-2.2</div><div class="line"></div><div class="line">Enter package <span class="comment"># to add, or a "[package] [version]" couple if it is not listed []: 0</span></div><div class="line">Search <span class="keyword">for</span> a package []:</div><div class="line"></div><div class="line">&#123;</div><div class="line">    <span class="string">"name"</span>: <span class="string">"kazu69/TEST_APP"</span>,</div><div class="line">    <span class="string">"description"</span>: <span class="string">"This app is TEST_APP"</span>,</div><div class="line">    <span class="string">"require-dev"</span>: &#123;</div><div class="line">        <span class="string">"codeception/codeception"</span>: <span class="string">"1.0.9"</span>,</div><div class="line">        <span class="string">"phpunit/phpunit"</span>: <span class="string">"3.7.0"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="string">"minimum-stability"</span>: <span class="string">"dev"</span>,</div><div class="line">    <span class="string">"authors"</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="string">"name"</span>: <span class="string">"kazu69"</span>,</div><div class="line">            <span class="string">"email"</span>: <span class="string">"*********@gmail.com"</span></div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    <span class="string">"require"</span>: &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">Do you confirm generation [yes]? </div><div class="line">Would you like the vendor directory added to your .gitignore [yes]?</div></pre></td></tr></table></figure>
<p>という感じでcomposer.jsonを作成できます。<br>そのほかのcliのコマンドは<a href="http://getcomposer.org/doc/03-cli.md" target="_blank" rel="external">ドキュメント</a>にまとまってました。</p>
<p>必要なパッケージをインストールします</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ composer install</div><div class="line">Loading composer repositories with package information</div><div class="line">Installing dependencies</div><div class="line">Nothing to install or update</div><div class="line">Generating <span class="built_in">autoload</span> files</div></pre></td></tr></table></figure>
<p>composer.lockとvendorディレクトリが作成されます。<br>パッケージはvendorディレクトリにインストールされます。<br>また、vendorにautoload.phpが作成されます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">YOUR_PROJECT_DIR</div><div class="line"> |-- .gitignore</div><div class="line"> |-- composer.json</div><div class="line"> |-- composer.phar</div><div class="line"> |-- composer.lock</div><div class="line"> |-- vendor</div><div class="line">       |-- autoload.php</div><div class="line">       |-- composer/</div></pre></td></tr></table></figure>
<p>インストールしたライブラリを読込むのはこのautoload.phpをrequireすればいいということなので、とても簡単です。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>;</div></pre></td></tr></table></figure>
<p>composer.lockファイルが生成された段階で、composer.jsonを変更した場合はupdateする必要があります。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># インストールではなくupdate</span></div><div class="line">$ php composer.phar update</div></pre></td></tr></table></figure>
<p>これまでのphpでの外部ライブラリ管理法とちがって、なんだかスッキリした感じです。</p>
<h2 id="Codeception-setup"><a href="#Codeception-setup" class="headerlink" title="Codeception setup"></a>Codeception setup</h2><p>折角なので、、インストールした<a href="http://codeception.com/" target="_blank" rel="external">Codeception</a>のQuickStartだけやってみます。<br>正直、Codeceptionについてまだ調べてないので、半分妄想レベル。<br>CodeceptionはPHP製のフルスタックのテストフレームワーク。<br>受け入れテスト、機能テスト、単体テストがこれだけでできる。Selenium, Mink, ZombieJSなどフロントのテスト機能もオールインワンっぽい。<a href="http://behat.org/" target="_blank" rel="external">Behat</a>やPHPUintをまとめて使えるようなもの。</p>
<p>ということで、やってみる。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># dowunload</span></div><div class="line">$ wget http://codeception.com/codecept.phar</div><div class="line"></div><div class="line"><span class="comment"># codeception.yml と テストディレクトリ作成</span></div><div class="line">$ php codecept.phar bootstrap</div><div class="line"></div><div class="line">File codeception.yml written - global configuration</div><div class="line">tests/unit created - unit tests</div><div class="line">tests/functional created - functional tests</div><div class="line">tests/acceptance created - acceptance tests</div><div class="line">tests/unit.suite.yml written - unit tests suite configuration</div><div class="line">tests/functional.suite.yml written - functional tests suite configuration</div><div class="line">tests/acceptance.suite.yml written - acceptance tests suite configuration</div><div class="line">Building initial Guy classes</div><div class="line">/YOUR_PROJECT_DIR/tests/acceptance/WebGuy.php generated sucessfully. 25 methods added</div><div class="line">/YOUR_PROJECT_DIR/tests/functional/TestGuy.php generated sucessfully. 9 methods added</div><div class="line">/YOUR_PROJECT_DIR/tests/unit/CodeGuy.php generated sucessfully. 25 methods added</div><div class="line"></div><div class="line">Bootstrap is <span class="keyword">done</span>. Check out /tests directory</div><div class="line"></div><div class="line"><span class="comment"># テストを作成</span></div><div class="line">$ php codecept.phar generate:cept acceptance Welcome</div><div class="line">Test was generated <span class="keyword">in</span> WelcomeCept.php</div></pre></td></tr></table></figure>
<p>生成したテストファイルを編集</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$I = <span class="keyword">new</span> WebGuy($scenario);</div><div class="line">$I-&gt;wantTo(<span class="string">'ensure that frontpage works'</span>);</div><div class="line">$I-&gt;amOnPage(<span class="string">'/'</span>); </div><div class="line">$I-&gt;see(<span class="string">'Home'</span>);</div></pre></td></tr></table></figure>
<p>PhpBrowserのURLを自身のアプリのURLに変更</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class_name: WebGuy</div><div class="line">modules:</div><div class="line">  enabled:</div><div class="line">    - PhpBrowser</div><div class="line">    - WebHelper</div><div class="line">  config:</div><div class="line">    PhpBrowser:</div><div class="line">      url: 'http://localhost/'</div></pre></td></tr></table></figure>
<p>テスト実行する。<br><a href="http://mink.behat.org/" target="_blank" rel="external">Mink</a>ベースのPhpBrowserというモジュールがinputの入力、リンククリックなどのUIテスト、post、getなどのアクセステストをするらしい。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">$ php codecept.phar run</div><div class="line"></div><div class="line">Suite acceptance started</div><div class="line">Trying to ensure that frontpage works (WelcomeCept.php) - Failed</div><div class="line"></div><div class="line">Suite functional started</div><div class="line"></div><div class="line">Suite unit started</div><div class="line"></div><div class="line">Time: 0 seconds, Memory: 9.75Mb</div><div class="line"></div><div class="line">There was 1 failure:</div><div class="line"></div><div class="line">* * *</div><div class="line"></div><div class="line">1) Couldn<span class="string">'t ensure that frontpage works in WelcomeCept.php</span></div><div class="line">Guy couldn't see <span class="string">"Home"</span>: <span class="string">'Home'</span> <span class="keyword">in</span> It works!.</div><div class="line">Failed asserting that response contains <span class="string">"home"</span>. Response was saved to <span class="string">'log'</span> directory.</div><div class="line"></div><div class="line">Scenario Steps:</div><div class="line">2\. I see <span class="string">"Home"</span></div><div class="line">1\. I am on page <span class="string">"/"</span></div><div class="line"></div><div class="line">FAILURES!</div><div class="line">Tests: 1, Assertions: 1, Failures: 1.</div></pre></td></tr></table></figure>
<p>という感じでした。phpunitでテストを書くよりもわかりやすいのかな？と感じました。</p>
<p>というわけで、ザザーっと最近のphpの開発環境周りを見てきました。<br>なんか、自動化されてて思っていたより便利になってる気がします。</p>
<h2 id="参考記事"><a href="#参考記事" class="headerlink" title="参考記事"></a>参考記事</h2><p><a href="http://starzero.hatenablog.com/entry/20120916/1347786793" target="_blank" rel="external">MacでApache、MySQL、PHPの環境を作る</a><br><a href="http://creator-life.net/modern-php-env/" target="_blank" rel="external">モダンなPHP開発環境を構築する</a><br><a href="http://blog.dataich.com/2012/01/11/multiple-versions-php-phpenv-phpbuild-pyrus/" target="_blank" rel="external">phpenv+php-build+pyrusでの複数バージョンPHP管理など</a><br><a href="http://www.ryuzee.com/contents/blog/5681" target="_blank" rel="external">PHPの外部ライブラリの管理にComposerを使う</a><br><a href="http://codeception.com/blog" target="_blank" rel="external">codeception blog</a></p>

    
  </div>

  
    <footer class="article-footer">

      
        <aside class="google-adsence">
          
<!-- Google Adsence -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-4054575508733221"
   data-ad-slot="9493597992"
   data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<!-- End Google Adsence -->


        </aside>
      

      <div class="share_content">
  <div class="hatena_sharebox">
    
      <a href="http://b.hatena.ne.jp/entry/blog.kazu69.net/2013/02/06/phpenv-php-build-composer/" class="hatena-bookmark-button" data-hatena-bookmark-title="phpenv + php-build + composer で開発環境作ってみた" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;"></a><script src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
    
  </div>
  
    <div class="addthis addthis_toolbox addthis_default_style">
      
        <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
      
      
        <a class="addthis_button_tweet"></a>
      
      
        <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
      
      
      <!-- <a class="addthis_counter addthis_pill_style"></a> -->
    </div>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-55a4f49a45ced975"></script>
  
</div>

      
        <a href="http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  

  
    
<nav id="article-nav">
  <div class="article-nav">
    
      <a href="/2013/03/01/rails-project-uses-a-javascript-package-management-tool-bower/" id="article-nav-newer" class="article-nav-link article-nav-link-newer">
        <span class="article-nav-caption">Newer - </span>
        <span class="article-nav-title">
          
            railsプロジェクトでjavascriptのパッケージ管理ツールBowerを使う
          
        </span>
      </a>
    
    
      <a href="/2013/01/10/grunt-jasmine-headless-unit-test/" id="article-nav-older" class="article-nav-link article-nav-link-older">
        <span class="article-nav-caption">Older - </span>
        <span class="article-nav-title">
          
            GruntでJasmineを使ったHeadlessなユニットテスト
          
        </span>
        </span>
      </a>
    
  </div>
</nav>

  
</article>


<section class="comments" id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
      
    </main>
    <footer id="footer" role="contentinfo">
  
  <div class="footer-cotent">
    <small>&copy; 2017 kazu69</small>
    <span class="generator">Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></span>
  </div>
</footer>
    
<script>
  var disqus_shortname = '69log';
  
  var disqus_url = 'http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

</body>
</html>