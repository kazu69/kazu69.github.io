<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>phpenv + php-build + composer で開発環境作ってみた | 69log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。">
<meta property="og:type" content="article">
<meta property="og:title" content="phpenv + php-build + composer で開発環境作ってみた">
<meta property="og:url" content="http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/index.html">
<meta property="og:site_name" content="69log">
<meta property="og:description" content="以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="phpenv + php-build + composer で開発環境作ってみた">
<meta name="twitter:description" content="以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。">
  
    <link rel="alternative" href="/atom.xml" title="69log" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-9196861-14', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
    <header role="header">
  <div class="header cf">
    <div class="title-content">
      <h1>
        <a href="/">69log</a>
      </h1>
      
        <h2>
          <a href="/">福岡でwebの仕事をしています</a>
        </h2>
      
    </div>

    <div class="nav-content cf">
      <nav>
        
          <a href="/" class="nav-link nav-home">home</a>
        
          <a href="/archives" class="nav-link nav-archives">archives</a>
        
        
          <a href="/atom.xml" title="RSS Feed" class="icon nav-link nav-feed"></a>
        
      </nav>
      <div class="header-search">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="q" value="site:http://blog.kazu69.net"></form>
      </div>
    </div>
  </div>
</header>

    <main role="main" id="main">
      <section><article id="post-phpenv-php-build-composer" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    
      
  
    <h1 class="article-title" itemprop="name">
      phpenv + php-build + composer で開発環境作ってみた
    </h1>
  

    
    <div class="article-meta clr">
      <time datetime="2013-02-06T10:11:56.000Z" itemprop="datePublished">2013-02-06</time>

      
  <div class="article-category">
    <a class="article-category-link" href="/categories/memo/">memo</a>
  </div>

    </div>
  </header>

  <div class="article-entry" itemprop="articleBody">
    <div class="article-gallery">
      
    </div>
    
      <p>以前、php勉強会で最近のphpの開発環境も簡単に構築できるとかという話を聞いていたので、調べながらちょっと開発環境を作ってみた。<br><a id="more"></a></p>
<h2 id="Apache_install">Apache install</h2><p>自分のmac(Mac10.8)ではあらかじめApacheは入っているのですが、せっかくなのでApache installから。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ brew tap Homebrew/dupes</span><br><span class="line">$ brew install httpd</span><br></pre></td></tr></table></figure>
<p>ApacheやPHPは<a href="http://mxcl.github.com/homebrew/" target="_blank" rel="external">homebrew</a>のFormulaでは管理されてないのですが、Homebrewに新たに追加されたtapコマンド使うことで任意のFormulaを追加できるらしい。<br>ちなみにtapが使えないときは<a href="https://github.com/mxcl/homebrew/wiki/FAQ" target="_blank" rel="external">brewのupdate</a>が必要。</p>
<p>続いてhttpd.confの設定</p>
<p>/usr/local/Cellar/httpd/2.2.22/etc/apache2/httpd.conf の 155行目付近<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ServerName gives the name and port that the server uses to identify itself.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This can often be determined automatically, but we recommend you specify</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># it explicitly to prevent problems during startup.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If your host doesn't have a registered DNS name, enter its IP address here.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">ServerName localhost:<span class="number">80</span></span><br></pre></td></tr></table></figure></p>
<p>DocumentRootを変更するならば、</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DocumentRoot: The directory out of which you will serve your</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># documents. By default, all requests are taken from this directory, but</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># symbolic links and aliases may be used to point to other locations.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">DocumentRoot <span class="string">"/Library/WebServer/Documents/"</span></span><br></pre></td></tr></table></figure>
<p>php5のモジュールはコメントアウトされているときはコメントアウトを削除しておく</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">LoadModule php5_module libexec/libphp5.so</span><br></pre></td></tr></table></figure>
<p>.phpでphpを実行できるようにMIMEタイプの追加</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;IfModule mime_module&gt;</span><br><span class="line">…</span><br><span class="line">AddType application/x-httpd-php .php</span><br><span class="line">…</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>
<p>indexファイルにindex.phpを使えるように修正</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">…</span><br><span class="line">DirectoryIndex index.html index.php</span><br><span class="line">…</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>
<p>.htaccessでURLのoverwriteを許可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;Directory <span class="string">"/usr/local/Cellar/httpd/2.2.22/share/apache2/htdocs"</span>&gt;</span><br><span class="line">…</span><br><span class="line">AllowOverride All</span><br><span class="line">…</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>
<p>このままでは起動時に<br>The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the log in /tmp/php-build.<strong>*</strong>.20130204001646.log のようなエラーがでるので、ログ用のディレクトリを追加します。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /usr/<span class="built_in">local</span>/Cellar/httpd/<span class="number">2.2</span>.<span class="number">22</span>/var/apache2/<span class="built_in">log</span></span><br><span class="line">$ mkdir /usr/<span class="built_in">local</span>/Cellar/httpd/<span class="number">2.2</span>.<span class="number">22</span>/var/apache2/run</span><br></pre></td></tr></table></figure>
<p>これでApacheの設定はとりあえず終了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 起動</span></span><br><span class="line"></span><br><span class="line">$ sudo apachectl start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line"></span><br><span class="line">$ sudo apachectl stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再起動</span></span><br><span class="line"></span><br><span class="line">$ sudo apachectl restart</span><br><span class="line"></span><br><span class="line">$ Apache version</span><br><span class="line">$ httpd -v</span><br><span class="line">Server version: Apache/<span class="number">2.2</span>.<span class="number">22</span> (Unix)</span><br><span class="line">Server built:   Aug <span class="number">24</span> <span class="number">2012</span> <span class="number">17</span>:<span class="number">16</span>:<span class="number">58</span></span><br></pre></td></tr></table></figure>
<h2 id="MySQL_install">MySQL install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew install mysql</span><br><span class="line">$ mysql_install_db --verbose -user=$(whoami) --basedir=<span class="string">"<span class="variable">$(brew --prefix mysql)</span>"</span> --datadir=/usr/<span class="built_in">local</span>/var/mysql --tmpdir=/tmp</span><br></pre></td></tr></table></figure>
<h2 id="phpenvinstall">phpenvinstall</h2><p>続いて<a href="https://github.com/CHH/phpenv" target="_blank" rel="external">phpenv</a>のインストール。phpenvは<a href="https://github.com/sstephenson/rbenv/" target="_blank" rel="external">rbenv</a>を使って異なるバージョンのphpを管理するツール。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$brew</span> install --HEAD phpenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># .bashrcなどに追加</span></span><br><span class="line"></span><br><span class="line">$ vi ~/.bashrc</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$HOME</span>/.phpenv/bin:<span class="variable">$PATH</span>"</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="variable">$(phpenv init -)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 設定したPATHの設定を有効にする</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<h2 id="php-build_install">php-build install</h2><p><a href="https://github.com/CHH/php-build" target="_blank" rel="external">php-build</a>は phpのダウンロードからインストールまでを行うツール</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ brew install php-build</span><br><span class="line"></span><br><span class="line">Add the following script block to `<span class="variable">$HOME</span>/.bashrc`, `<span class="variable">$HOME</span>/.zshrc`, or your shell<span class="string">'s equivalent configuration file.</span><br><span class="line"></span><br><span class="line">Change `5.x.x` to the version of PHP you'</span>d like your shell to default to or remove `php-version <span class="number">5</span>.x.x &amp;amp;gt;/dev/null`</span><br><span class="line"><span class="keyword">if</span> you <span class="keyword">do</span> not wish to have a default version of PHP loaded into your `<span class="variable">$PATH</span>`. The large comment block is optional:</span><br><span class="line"></span><br><span class="line"><span class="comment">###### #</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># php-version (activate default PHP version and autocompletion)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PHP_HOME                      =&gt; should reflect location of compiled PHP versions</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PHPVERSION_DISABLE_COMPLETE=1 =&gt; to disable shell completion</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###### #</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PHP_VERSIONS=$(dirname $(brew --prefix php))</span><br><span class="line">[ <span class="operator">-f</span> $(brew --prefix php-version)/php-version.sh ] &amp;amp;&amp;amp;</span><br><span class="line">  <span class="built_in">source</span> $(brew --prefix php-version)/php-version.sh &amp;amp;&amp;amp; php-version <span class="number">5</span>.x.x &gt;/dev/null</span><br><span class="line">/usr/<span class="built_in">local</span>/Cellar/php-version/<span class="number">0.9</span>.<span class="number">3</span>: <span class="number">3</span> files, <span class="number">20</span>K, built <span class="keyword">in</span> <span class="number">2</span> seconds</span><br><span class="line"></span><br><span class="line"><span class="comment"># php-buildのPATHを追加</span></span><br><span class="line"></span><br><span class="line">$ vi ~/.bashrc</span><br><span class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 設定したPATHの設定を有効にする</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>ダウンロードできるバージョンの確認</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ php-build --definitions</span><br><span class="line"><span class="number">5.2</span>.<span class="number">17</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">10</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">11</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">11</span>RC1</span><br><span class="line"><span class="number">5.3</span>.<span class="number">11</span>RC2</span><br><span class="line"><span class="number">5.3</span>.<span class="number">12</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">13</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">14</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">15</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">2</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">3</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">6</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">8</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">9</span></span><br><span class="line"><span class="number">5.3</span>.<span class="number">9</span>RC3</span><br><span class="line"><span class="number">5.3</span>.<span class="number">9</span>RC4</span><br><span class="line"><span class="number">5.3</span>snapshot</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span></span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>RC1</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>RC2</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>RC3</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>RC4</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>RC5</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>RC6</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>RC7</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>RC8</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>alpha3</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>beta1</span><br><span class="line"><span class="number">5.4</span>.<span class="number">0</span>beta2</span><br><span class="line"><span class="number">5.4</span>.<span class="number">1</span></span><br><span class="line"><span class="number">5.4</span>.<span class="number">1</span>RC1</span><br><span class="line"><span class="number">5.4</span>.<span class="number">1</span>RC2</span><br><span class="line"><span class="number">5.4</span>.<span class="number">2</span></span><br><span class="line"><span class="number">5.4</span>.<span class="number">3</span></span><br><span class="line"><span class="number">5.4</span>.<span class="number">4</span></span><br><span class="line"><span class="number">5.4</span>.<span class="number">5</span></span><br><span class="line"><span class="number">5.4</span>snapshot</span><br></pre></td></tr></table></figure>
<p>php-buildはApacheのモジュールには対応してないようなので、Apacheのモジュールが生成されるように設定を変更します。<br>/usr/local/share/php-build/default_configure_options に以下を追加します。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 以下の1行を追加</span></span><br><span class="line"></span><br><span class="line">--with-apxs2=/usr/<span class="built_in">local</span>/sbin/apxs</span><br></pre></td></tr></table></figure></p>
<p>これでphpを自動で展開してモジュールも生成します。適当なphpをホームディレクトリ以下にinstallして展開します。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ php-build <span class="number">5.4</span>.<span class="number">5</span> ~/.phpenv/versions/<span class="number">5.4</span>.<span class="number">5</span></span><br><span class="line">[Info]: Loaded pyrus Plugin.</span><br><span class="line">[Info]: Loaded xdebug Plugin.</span><br><span class="line">[Info]: php.ini-production gets used as php.ini</span><br><span class="line">[Info]: Building <span class="number">5.4</span>.<span class="number">0</span> into /Users/***/.phpenv/versions/<span class="number">5.4</span>.<span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>おそらくmake時にいろいろとエラーが出るので、その都度解決してあげる必要があります。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## # エラーが出た</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## configure: warning: You will need re2c 0.13.4 or later if you want to regenerate PHP parsers. ./configure: line 6372: /usr/local/sbin/apxs: No such file or directory configure: error: Aborting</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加</span></span><br><span class="line"></span><br><span class="line">$ brew install re2c</span><br><span class="line"></span><br><span class="line"><span class="comment">## # エラーが出た</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## configure: error: png.h not found.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加</span></span><br><span class="line"></span><br><span class="line">$ brew install libpng</span><br><span class="line"></span><br><span class="line"><span class="comment">## # エラーが出た</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## configure: error: mcrypt.h not found. Please reinstall libmcrypt.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加</span></span><br><span class="line"></span><br><span class="line">$ brew install libmcrypt</span><br><span class="line"></span><br><span class="line"><span class="comment"># そして改めて</span></span><br><span class="line"></span><br><span class="line">$ php-build <span class="number">5.4</span>.<span class="number">5</span> ~/.phpenv/versions/<span class="number">5.4</span>.<span class="number">5</span></span><br><span class="line">[Info]: Loaded pyrus Plugin.</span><br><span class="line">[Info]: Loaded xdebug Plugin.</span><br><span class="line">[Info]: php.ini-production gets used as php.ini</span><br><span class="line">[Info]: Building <span class="number">5.4</span>.<span class="number">5</span> into /Users/**_/.phpenv/versions/<span class="number">5.4</span>.<span class="number">5</span></span><br><span class="line">[Skipping]: Already downloaded and extracted http://www.php.net/distributions/php-<span class="number">5.4</span>.<span class="number">5</span>.tar.bz2</span><br><span class="line">[Pyrus]: Downloading from http://pear2.php.net/pyrus.phar</span><br><span class="line">[Pyrus]: Installing executable <span class="keyword">in</span> /Users/_**/.phpenv/versions/<span class="number">5.4</span>.<span class="number">5</span>/bin/pyrus</span><br><span class="line">[XDebug]: Downloading http://xdebug.org/files/xdebug-<span class="number">2.2</span>.<span class="number">0</span>.tgz</span><br><span class="line">[XDebug]: Compiling <span class="keyword">in</span> /var/tmp/php-build/<span class="built_in">source</span>/xdebug-<span class="number">2.2</span>.<span class="number">0</span></span><br><span class="line">[XDebug]: Installing XDebug configuration <span class="keyword">in</span> /Users/***/.phpenv/versions/<span class="number">5.4</span>.<span class="number">5</span>/etc/conf.d/xdebug.ini</span><br><span class="line">[XDebug]: Cleaning up.</span><br><span class="line">[Info]: The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the <span class="built_in">log</span> <span class="keyword">in</span> /tmp/php-build.<span class="number">5.4</span>.<span class="number">5.20130201001646</span>.log</span><br><span class="line">[Success]: Built <span class="number">5.4</span>.<span class="number">5</span> successfully.</span><br></pre></td></tr></table></figure>
<p>ちなみに、後ほどモジュールの切替をおこなうのでインストールしたモジュールは退避させておきます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># libphp5.so を退避しておく</span></span><br><span class="line"></span><br><span class="line">$ mv /usr/<span class="built_in">local</span>/Cellar/httpd/<span class="number">2.2</span>.<span class="number">22</span>/libexec/libphp5.so ~/.phpenv/versions/<span class="number">5.4</span>.<span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>phpenvで確認</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ phpenv versions</span><br><span class="line">* system (<span class="built_in">set</span> by /Users/***/.phpenv/version)</span><br><span class="line">  <span class="number">5.4</span>.<span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>system はあらかじめmacに入っているphpです。<br>php-buildでインストールしたphpはユーザーのホームディレクトリの.phpenvディレクトリに展開されてます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ユーザーのホームディレクトリ</span></span><br><span class="line"></span><br><span class="line">.phpenv/</span><br><span class="line">  |--versions</span><br><span class="line">      |--<span class="number">5.4</span>.<span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>そしてphpのバージョンを切替え</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ phpenv global <span class="number">5.4</span>.<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># バージョン確認</span></span><br><span class="line"></span><br><span class="line">$ php -v</span><br><span class="line">PHP <span class="number">5.4</span>.<span class="number">5</span> (cli) (built: Feb  <span class="number">1</span> <span class="number">2013</span> <span class="number">00</span>:<span class="number">21</span>:<span class="number">44</span>) </span><br><span class="line">Copyright (c) <span class="number">1997</span>-<span class="number">2012</span> The PHP Group</span><br><span class="line">Zend Engine v2.<span class="number">4.0</span>, Copyright (c) <span class="number">1998</span>-<span class="number">2012</span> Zend Technologies</span><br><span class="line">    with Xdebug v2.<span class="number">2.0</span>, Copyright (c) <span class="number">2002</span>-<span class="number">2012</span>, by Derick Rethan</span><br></pre></td></tr></table></figure>
<p>これでphpのバージョンは切替りました。<br>では、DocumentRoot にphpinfo()を実行するファイルをおいて、バージョンが切替っていることを確認。</p>
<p>が、こちらでは変わってない。<br>これは、phpenvはApacheのphpモジュールの切替えを行わないので、Apacheのphpは切り替わってません。<br>ということで、Apacheのモジュール切替スクリプト(rbenv-apache-version)を追加します。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ~/.phpenv/libexec/rbenv-apache-version</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> <span class="operator">-e</span></span><br><span class="line">[ -n <span class="string">"<span class="variable">$RBENV_DEBUG</span>"</span> ] &amp;amp;&amp;amp; <span class="built_in">set</span> -x</span><br><span class="line"></span><br><span class="line"><span class="comment"># Provide rbenv completions</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> = <span class="string">"--complete"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> system</span><br><span class="line">  <span class="built_in">exec</span> rbenv-versions --bare</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">RBENV_VERSION=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">RBENV_ON_FILE=<span class="string">"<span class="variable">$&#123;RBENV_ROOT&#125;</span>/versions"</span></span><br><span class="line">APACHE_ROOT=<span class="string">"/usr/local/Cellar/httpd/2.2.22"</span></span><br><span class="line">APACHE_MODULE_PATH=<span class="string">"<span class="variable">$&#123;APACHE_ROOT&#125;</span>/libexec"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Make sure the specified version is installed.</span></span><br><span class="line"></span><br><span class="line">RBENV_PREFIX_PATH=<span class="string">"<span class="variable">$&#123;RBENV_ROOT&#125;</span>/versions/<span class="variable">$&#123;RBENV_VERSION&#125;</span>"</span></span><br><span class="line"><span class="keyword">if</span> [ ! <span class="operator">-d</span> <span class="string">"<span class="variable">$RBENV_PREFIX_PATH</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"rbenv: version &amp;#96;<span class="variable">$&#123;RBENV_VERSION&#125;</span>' not installed"</span> &gt;&amp;amp;<span class="number">2</span></span><br><span class="line">  <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">PHP_MODULE_PATH=<span class="string">"<span class="variable">$RBENV_PREFIX_PATH</span>/libphp5.so"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! <span class="operator">-f</span> <span class="string">"<span class="variable">$PHP_MODULE_PATH</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"apache module not found \'<span class="variable">$&#123;PHP_MODULE_PATH&#125;</span>'"</span> &gt;&amp;amp;<span class="number">2</span></span><br><span class="line">  <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! <span class="operator">-d</span> <span class="string">"<span class="variable">$APACHE_MODULE_PATH</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Directory not found \'<span class="variable">$&#123;APACHE_MODULE_PATH&#125;</span>'"</span> &gt;&amp;amp;<span class="number">2</span></span><br><span class="line">  <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"copy <span class="variable">$&#123;PHP_MODULE_PATH&#125;</span> to <span class="variable">$&#123;APACHE_MODULE_PATH&#125;</span>"</span></span><br><span class="line">cp <span class="string">"<span class="variable">$PHP_MODULE_PATH</span>"</span> <span class="string">"<span class="variable">$APACHE_MODULE_PATH</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Restarting apache..."</span></span><br><span class="line">sudo apachectl restart</span><br></pre></td></tr></table></figure>
<p>実行権限を付与して、phpの切替えとApacheのモジュールの切替えを行います。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chmod <span class="number">755</span> /Users/**_/.phpenv/libexec/rbenv-apache-version</span><br><span class="line">$ phpenv global <span class="number">5.4</span>.<span class="number">5</span></span><br><span class="line">$ phpenv apache-version <span class="number">5.4</span>.<span class="number">5</span></span><br><span class="line">copy /Users/_**/.phpenv/versions/<span class="number">5.4</span>.<span class="number">5</span>/libphp5.so to /usr/<span class="built_in">local</span>/Cellar/httpd/<span class="number">2.2</span>.<span class="number">22</span>/libexec</span><br><span class="line">Restarting apache...</span><br><span class="line">Password:</span><br></pre></td></tr></table></figure>
<p>Apacheが再起動して、モジュールが読込まれるとphpのバージョン切替ができます。<br>ちなみにphp5.4.0からはビルトインサーバーもあるので、そちらを使えばApacheのモジュール切替は不要です。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 適当なディレクトリにおいて</span></span><br><span class="line"></span><br><span class="line">$ php -S localhost:<span class="number">8080</span></span><br><span class="line">PHP <span class="number">5.4</span>.<span class="number">5</span> Development Server started at Fri Feb  <span class="number">1</span> <span class="number">01</span>:<span class="number">48</span>:<span class="number">54</span> <span class="number">2013</span></span><br><span class="line">Listening on localhost:<span class="number">8080</span></span><br><span class="line">Document root is /Users/***/YOUR-APP-DIR</span><br><span class="line">Press Ctrl-C to quit.</span><br></pre></td></tr></table></figure>
<h2 id="composer_install">composer install</h2><p><a href="http://getcomposer.org/" target="_blank" rel="external">composer</a> は 外部ライブラリの依存管理ツール(PHP 5.3.2 or above)。<br>rubyでいうところのbundler、nodeでいうところのnpmみたいなものらしい。<br>登録されているパッケージは<a href="https://packagist.org" target="_blank" rel="external">Packagist</a>で検索できます。また、自身で作成したパッケージも登録できます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># globalにインストール</span></span><br><span class="line"></span><br><span class="line">$ brew tap josegonzalez/homebrew-php</span><br><span class="line">$ brew install josegonzalez/php/composer</span><br><span class="line"></span><br><span class="line"><span class="comment"># vendorを作成するディレクトリでphp archiveファイル(composer.phar)をダウンロード</span></span><br><span class="line"></span><br><span class="line">$ curl <span class="operator">-s</span> https://getcomposer.org/installer | php</span><br></pre></td></tr></table></figure>
<p>外部ライブラリはカレントディレクトリのcomposer.jsonで管理されます。<br>jsonファイルで定義したパッケージをautoloadしてくれます。</p>
<p>以下のような感じです。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">YOUR_PROJECT_DIR</span><br><span class="line"> |-- vendor</span><br><span class="line"> |-- composer.json</span><br><span class="line"> |-- composer.phar</span><br></pre></td></tr></table></figure>
<p>phpのユニットテストフレームワーク<a href="https://github.com/sebastianbergmann/phpunit/" target="_blank" rel="external">phpunit</a>と、インテグレーションテストフレームワーク<a href="http://codeception.com/" target="_blank" rel="external">codeception</a>をインストールしてみようと思います。<br>composer.jsonを別個で作成してもいいですが、対話式のパッケージ作成コマンドもあります。今回は対話式のパッケージ作成コマンドで<br>composer.jsonを作成してみます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">$ composer init</span><br><span class="line"></span><br><span class="line">Welcome to the Composer config generator</span><br><span class="line"></span><br><span class="line">This <span class="built_in">command</span> will guide you through creating your composer.json config.</span><br><span class="line"></span><br><span class="line"><span class="comment"># パッケージ名</span></span><br><span class="line"></span><br><span class="line">Package name (&lt;vendor&gt;/&lt;name&gt;) [kazu69/t]: kazu69/TEST_APP</span><br><span class="line"></span><br><span class="line"><span class="comment"># パッケージの説明</span></span><br><span class="line"></span><br><span class="line">Description []: This app is TEST_APP</span><br><span class="line"></span><br><span class="line"><span class="comment"># パッケージの作者名</span></span><br><span class="line"></span><br><span class="line">Author [kazu69 &lt;*********@gmail.com&gt;]:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安定性の説明 dev, alpha, beta, RC, and stable</span></span><br><span class="line"></span><br><span class="line">Minimum Stability []: dev</span><br><span class="line"></span><br><span class="line">Define your dependencies.</span><br><span class="line"></span><br><span class="line">Would you like to define your dependencies (require) interactively [yes]?</span><br><span class="line"></span><br><span class="line"><span class="comment"># 必要なパッケージとバージョン</span></span><br><span class="line"></span><br><span class="line">Search <span class="keyword">for</span> a package []: Codeception</span><br><span class="line">Would you like to define your dev dependencies (require-dev) interactively [yes]?</span><br><span class="line"></span><br><span class="line"><span class="comment"># 開発環境でパッケージに必要なパッケージとバージョン</span></span><br><span class="line"></span><br><span class="line">Search <span class="keyword">for</span> a package []: Codeception</span><br><span class="line"></span><br><span class="line"><span class="comment"># search は非常に遅い</span></span><br><span class="line"></span><br><span class="line">Found <span class="number">33</span> packages matching Codeception/Codeception</span><br><span class="line"></span><br><span class="line">[<span class="number">0</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">9</span></span><br><span class="line">   [<span class="number">1</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">10</span></span><br><span class="line">   [<span class="number">2</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">11</span></span><br><span class="line">   [<span class="number">3</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">12</span></span><br><span class="line">   [<span class="number">4</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">13</span></span><br><span class="line">   [<span class="number">5</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">14</span></span><br><span class="line">   [<span class="number">6</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">0</span></span><br><span class="line">   [<span class="number">7</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">2</span></span><br><span class="line">   [<span class="number">8</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">3</span></span><br><span class="line">   [<span class="number">9</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">4</span></span><br><span class="line">  [<span class="number">10</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">5</span></span><br><span class="line">  [<span class="number">11</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">10</span></span><br><span class="line">  [<span class="number">12</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">11</span></span><br><span class="line">  [<span class="number">13</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">12</span></span><br><span class="line">  [<span class="number">14</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">13</span></span><br><span class="line">  [<span class="number">15</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">14</span></span><br><span class="line">  [<span class="number">16</span>] Codeception/Codeception <span class="number">1.0</span>.<span class="number">9</span></span><br><span class="line">  [<span class="number">17</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">0</span></span><br><span class="line">  [<span class="number">18</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">2</span></span><br><span class="line">  [<span class="number">19</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">3</span></span><br><span class="line">  [<span class="number">20</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">4</span></span><br><span class="line">  [<span class="number">21</span>] Codeception/Codeception <span class="number">1.1</span>.<span class="number">5</span></span><br><span class="line"></span><br><span class="line">Enter package <span class="comment"># to add, or a "[package] [version]" couple if it is not listed []: 0</span></span><br><span class="line">Search <span class="keyword">for</span> a package []: phpunit/phpunit</span><br><span class="line"></span><br><span class="line"><span class="comment"># search は非常に遅い</span></span><br><span class="line"></span><br><span class="line">Found <span class="number">33</span> packages matching phpunit/phpunit</span><br><span class="line"></span><br><span class="line">[<span class="number">0</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">0</span></span><br><span class="line">   [<span class="number">1</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">1</span></span><br><span class="line">   [<span class="number">2</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">10</span></span><br><span class="line">   [<span class="number">3</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">2</span></span><br><span class="line">   [<span class="number">4</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">3</span></span><br><span class="line">   [<span class="number">5</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">4</span></span><br><span class="line">   [<span class="number">6</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">5</span></span><br><span class="line">   [<span class="number">7</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">6</span></span><br><span class="line">   [<span class="number">8</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">7</span></span><br><span class="line">   [<span class="number">9</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">8</span></span><br><span class="line">  [<span class="number">10</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">9</span></span><br><span class="line">  [<span class="number">11</span>] phpunit/phpunit-mock-objects <span class="number">1.2</span>.<span class="number">0</span></span><br><span class="line">  [<span class="number">12</span>] phpunit/phpunit-mock-objects <span class="number">1.2</span>.<span class="number">1</span></span><br><span class="line">  [<span class="number">13</span>] phpunit/phpunit-mock-objects <span class="number">1.2</span>.<span class="number">2</span></span><br><span class="line">  [<span class="number">14</span>] phpunit/phpunit-selenium <span class="number">1.2</span>.<span class="number">10</span></span><br><span class="line">  [<span class="number">15</span>] phpunit/phpunit-selenium <span class="number">1.2</span>.<span class="number">11</span></span><br><span class="line">  [<span class="number">16</span>] phpunit/phpunit-selenium <span class="number">1.2</span>.<span class="number">9</span></span><br><span class="line">  [<span class="number">17</span>] phpunit/phpunit-story <span class="number">1.0</span>.<span class="number">1</span></span><br><span class="line">  [<span class="number">18</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">11</span></span><br><span class="line">  [<span class="number">19</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">12</span></span><br><span class="line">  [<span class="number">20</span>] phpunit/phpunit <span class="number">3.7</span>.<span class="number">13</span></span><br><span class="line">  [<span class="number">21</span>] phpunit/phpunit-mock-objects <span class="number">1.2</span>.<span class="number">3</span></span><br><span class="line">  [<span class="number">22</span>] phpunit/phpunit-selenium <span class="number">1.2</span>.<span class="number">12</span></span><br><span class="line">  [<span class="number">23</span>] phpunit/phpunit-selenium dev-master</span><br><span class="line">  [<span class="number">24</span>] phpunit/phpunit-story dev-master</span><br><span class="line">  [<span class="number">25</span>] phpunit/phpunit-mock-objects <span class="number">1.2</span>.x-dev</span><br><span class="line">  [<span class="number">26</span>] phpunit/phpunit-mock-objects dev-master</span><br><span class="line">  [<span class="number">27</span>] phpunit/phpunit-mock-objects <span class="number">1.3</span>.x-dev</span><br><span class="line">  [<span class="number">28</span>] phpunit/phpunit <span class="number">3.7</span>.x-dev</span><br><span class="line">  [<span class="number">29</span>] phpunit/phpunit dev-master</span><br><span class="line">  [<span class="number">30</span>] phpunit/phpunit <span class="number">3.8</span>.x-dev</span><br><span class="line">  [<span class="number">31</span>] phpunit/phpunit dev-refactoring</span><br><span class="line">  [<span class="number">32</span>] phpunit/phpunit dev-symfony-<span class="number">2.2</span></span><br><span class="line"></span><br><span class="line">Enter package <span class="comment"># to add, or a "[package] [version]" couple if it is not listed []: 0</span></span><br><span class="line">Search <span class="keyword">for</span> a package []:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"kazu69/TEST_APP"</span>,</span><br><span class="line">    <span class="string">"description"</span>: <span class="string">"This app is TEST_APP"</span>,</span><br><span class="line">    <span class="string">"require-dev"</span>: &#123;</span><br><span class="line">        <span class="string">"codeception/codeception"</span>: <span class="string">"1.0.9"</span>,</span><br><span class="line">        <span class="string">"phpunit/phpunit"</span>: <span class="string">"3.7.0"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"minimum-stability"</span>: <span class="string">"dev"</span>,</span><br><span class="line">    <span class="string">"authors"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"kazu69"</span>,</span><br><span class="line">            <span class="string">"email"</span>: <span class="string">"*********@gmail.com"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"require"</span>: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Do you confirm generation [yes]? </span><br><span class="line">Would you like the vendor directory added to your .gitignore [yes]?</span><br></pre></td></tr></table></figure>
<p>という感じでcomposer.jsonを作成できます。<br>そのほかのcliのコマンドは<a href="http://getcomposer.org/doc/03-cli.md" target="_blank" rel="external">ドキュメント</a>にまとまってました。</p>
<p>必要なパッケージをインストールします</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ composer install</span><br><span class="line">Loading composer repositories with package information</span><br><span class="line">Installing dependencies</span><br><span class="line">Nothing to install or update</span><br><span class="line">Generating <span class="built_in">autoload</span> files</span><br></pre></td></tr></table></figure>
<p>composer.lockとvendorディレクトリが作成されます。<br>パッケージはvendorディレクトリにインストールされます。<br>また、vendorにautoload.phpが作成されます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">YOUR_PROJECT_DIR</span><br><span class="line"> |-- .gitignore</span><br><span class="line"> |-- composer.json</span><br><span class="line"> |-- composer.phar</span><br><span class="line"> |-- composer.lock</span><br><span class="line"> |-- vendor</span><br><span class="line">       |-- autoload.php</span><br><span class="line">       |-- composer/</span><br></pre></td></tr></table></figure>
<p>インストールしたライブラリを読込むのはこのautoload.phpをrequireすればいいということなので、とても簡単です。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>;</span><br></pre></td></tr></table></figure>
<p>composer.lockファイルが生成された段階で、composer.jsonを変更した場合はupdateする必要があります。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># インストールではなくupdate</span></span><br><span class="line"></span><br><span class="line">$ php composer.phar update</span><br></pre></td></tr></table></figure>
<p>これまでのphpでの外部ライブラリ管理法とちがって、なんだかスッキリした感じです。</p>
<h2 id="Codeception_setup">Codeception setup</h2><p>折角なので、、インストールした<a href="http://codeception.com/" target="_blank" rel="external">Codeception</a>のQuickStartだけやってみます。<br>正直、Codeceptionについてまだ調べてないので、半分妄想レベル。<br>CodeceptionはPHP製のフルスタックのテストフレームワーク。<br>受け入れテスト、機能テスト、単体テストがこれだけでできる。Selenium, Mink, ZombieJSなどフロントのテスト機能もオールインワンっぽい。<a href="http://behat.org/" target="_blank" rel="external">Behat</a>やPHPUintをまとめて使えるようなもの。</p>
<p>ということで、やってみる。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># dowunload</span></span><br><span class="line"></span><br><span class="line">$ wget http://codeception.com/codecept.phar</span><br><span class="line"></span><br><span class="line"><span class="comment"># codeception.yml と テストディレクトリ作成</span></span><br><span class="line"></span><br><span class="line">$ php codecept.phar bootstrap</span><br><span class="line"></span><br><span class="line">File codeception.yml written - global configuration</span><br><span class="line">tests/unit created - unit tests</span><br><span class="line">tests/functional created - functional tests</span><br><span class="line">tests/acceptance created - acceptance tests</span><br><span class="line">tests/unit.suite.yml written - unit tests suite configuration</span><br><span class="line">tests/functional.suite.yml written - functional tests suite configuration</span><br><span class="line">tests/acceptance.suite.yml written - acceptance tests suite configuration</span><br><span class="line">Building initial Guy classes</span><br><span class="line">/YOUR_PROJECT_DIR/tests/acceptance/WebGuy.php generated sucessfully. <span class="number">25</span> methods added</span><br><span class="line">/YOUR_PROJECT_DIR/tests/functional/TestGuy.php generated sucessfully. <span class="number">9</span> methods added</span><br><span class="line">/YOUR_PROJECT_DIR/tests/unit/CodeGuy.php generated sucessfully. <span class="number">25</span> methods added</span><br><span class="line"></span><br><span class="line">Bootstrap is done. Check out /tests directory</span><br><span class="line"></span><br><span class="line"><span class="comment"># テストを作成</span></span><br><span class="line"></span><br><span class="line">$ php codecept.phar generate:cept acceptance Welcome</span><br><span class="line">Test was generated <span class="keyword">in</span> WelcomeCept.php</span><br></pre></td></tr></table></figure>
<p>生成したテストファイルを編集</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$I</span> = <span class="keyword">new</span> WebGuy(<span class="variable">$scenario</span>);</span><br><span class="line"><span class="variable">$I</span>-&gt;wantTo(<span class="string">'ensure that frontpage works'</span>);</span><br><span class="line"><span class="variable">$I</span>-&gt;amOnPage(<span class="string">'/'</span>); </span><br><span class="line"><span class="variable">$I</span>-&gt;see(<span class="string">'Home'</span>);</span><br></pre></td></tr></table></figure>
<p>PhpBrowserのURLを自身のアプリのURLに変更</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class_name: WebGuy</span><br><span class="line">modules:</span><br><span class="line">  enabled:</span><br><span class="line">    - PhpBrowser</span><br><span class="line">    - WebHelper</span><br><span class="line">  config:</span><br><span class="line">    PhpBrowser:</span><br><span class="line">      url: 'http://localhost/'</span><br></pre></td></tr></table></figure>
<p>テスト実行する。<br><a href="http://mink.behat.org/" target="_blank" rel="external">Mink</a>ベースのPhpBrowserというモジュールがinputの入力、リンククリックなどのUIテスト、post、getなどのアクセステストをするらしい。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ php codecept.phar run</span><br><span class="line"></span><br><span class="line">Suite acceptance started</span><br><span class="line">Trying to ensure that frontpage works (WelcomeCept.php) - Failed</span><br><span class="line"></span><br><span class="line">Suite functional started</span><br><span class="line"></span><br><span class="line">Suite unit started</span><br><span class="line"></span><br><span class="line">Time: <span class="number">0</span> seconds, Memory: <span class="number">9.75</span>Mb</span><br><span class="line"></span><br><span class="line">There was <span class="number">1</span> failure:</span><br><span class="line"></span><br><span class="line">* * *</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>) Couldn<span class="string">'t ensure that frontpage works in WelcomeCept.php</span><br><span class="line">Guy couldn'</span>t see <span class="string">"Home"</span>: <span class="string">'Home'</span> <span class="keyword">in</span> It works!.</span><br><span class="line">Failed asserting that response contains <span class="string">"home"</span>. Response was saved to <span class="string">'log'</span> directory.</span><br><span class="line"></span><br><span class="line">Scenario Steps:</span><br><span class="line"><span class="number">2</span>\. I see <span class="string">"Home"</span></span><br><span class="line"><span class="number">1</span>\. I am on page <span class="string">"/"</span></span><br><span class="line"></span><br><span class="line">FAILURES!</span><br><span class="line">Tests: <span class="number">1</span>, Assertions: <span class="number">1</span>, Failures: <span class="number">1</span>.</span><br></pre></td></tr></table></figure>
<p>という感じでした。phpunitでテストを書くよりもわかりやすいのかな？と感じました。</p>
<p>というわけで、ザザーっと最近のphpの開発環境周りを見てきました。<br>なんか、自動化されてて思っていたより便利になってる気がします。</p>
<h2 id="参考記事">参考記事</h2><p><a href="http://starzero.hatenablog.com/entry/20120916/1347786793" target="_blank" rel="external">MacでApache、MySQL、PHPの環境を作る</a><br><a href="http://creator-life.net/modern-php-env/" target="_blank" rel="external">モダンなPHP開発環境を構築する</a><br><a href="http://blog.dataich.com/2012/01/11/multiple-versions-php-phpenv-phpbuild-pyrus/" target="_blank" rel="external">phpenv+php-build+pyrusでの複数バージョンPHP管理など</a><br><a href="http://www.ryuzee.com/contents/blog/5681" target="_blank" rel="external">PHPの外部ライブラリの管理にComposerを使う</a><br><a href="http://codeception.com/blog" target="_blank" rel="external">codeception blog</a></p>

    
  </div>

  
    <footer class="article-footer">
      <a data-url="http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/" data-id="ci9ruongp0088w8p441m40ktc" class="article-share-link">Share</a>
      
        <a href="http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  

  
    
<nav id="article-nav">
  <div class="article-nav">
    
      <a href="/2013/03/01/rails-project-uses-a-javascript-package-management-tool-bower/" id="article-nav-newer" class="article-nav-link article-nav-link-newer">
        <span class="article-nav-caption">Newer - </span>
        <span class="article-nav-title">
          
            railsプロジェクトでjavascriptのパッケージ管理ツールBowerを使う
          
        </span>
      </a>
    
    
      <a href="/2013/01/10/grunt-jasmine-headless-unit-test/" id="article-nav-older" class="article-nav-link article-nav-link-older">
        <span class="article-nav-caption">Older - </span>
        <span class="article-nav-title">
          
            GruntでJasmineを使ったHeadlessなユニットテスト
          
        </span>
        </span>
      </a>
    
  </div>
</nav>

  
</article>


  <aside>
    
<!-- Google Adsence -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-4054575508733221"
   data-ad-slot="9493597992"
   data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<!-- End Google Adsence -->


  </aside>



<section class="comments" id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
      
    </main>
    <footer id="footer" role="contentinfo">
  
  <div class="footer-cotent">
    <small>&copy; 2015 kazu69</small>
    <span class="generator">Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></span>
  </div>
</footer>
    
<script>
  var disqus_shortname = '69log';
  
  var disqus_url = 'http://blog.kazu69.net/2013/02/06/phpenv-php-build-composer/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

</body>
</html>